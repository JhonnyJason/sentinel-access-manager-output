/*! For license information please see service.js.LICENSE.txt */
(()=>{"use strict";var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{addServerSignature:()=>m,initialize:()=>b,signatureAuth:()=>S});var r={};t.r(r),t.d(r,{freeRegistry:()=>R,getRegistry:()=>A,sciAdd:()=>I});var n={};t.r(n),t.d(n,{getPasswordHash:()=>Kt,initialize:()=>_t});var i={};t.r(i),t.d(i,{authCodeValidityMS:()=>Zt,persistentStateOptions:()=>Wt});var o={};t.r(o);var a={};t.r(a),t.d(a,{initialize:()=>Je,thrw:()=>Me});var u={};t.r(u),t.d(u,{ARRAY:()=>We,ARRAYORNOTHING:()=>cr,ARRAYORNULL:()=>xr,BOOLEAN:()=>Ze,BOOLEANORNOTHING:()=>sr,BOOLEANORNULL:()=>Er,INVALIDEMAIL:()=>Jr,INVALIDHEX:()=>Xr,INVALIDSIZE:()=>Mr,ISDIRTYOBJECT:()=>qr,ISDIRTYSTRING:()=>Fr,ISEMPTYARRAY:()=>Dr,ISEMPTYSTRING:()=>Vr,ISINVALID:()=>_r,ISNAN:()=>kr,ISNOTFINITE:()=>Yr,ISNULL:()=>Pr,NONEMPTYARRAY:()=>mr,NONEMPTYSTRING:()=>Sr,NONEMPTYSTRINGCLEAN:()=>Rr,NONEMPTYSTRINGHEX:()=>Ar,NONNULLOBJECT:()=>br,NONNULLOBJECTCLEAN:()=>Gr,NOTABOOLEAN:()=>zr,NOTANARRAY:()=>Cr,NOTANOBJECT:()=>Br,NOTANUMBER:()=>Ur,NOTASTRING:()=>$r,NUMBER:()=>Ke,NUMBERORNOTHING:()=>fr,NUMBERORNULL:()=>Or,OBJECT:()=>Qe,OBJECTCLEAN:()=>Lr,OBJECTCLEANORNOTHING:()=>jr,OBJECTORNOTHING:()=>lr,STRING:()=>ke,STRINGCLEAN:()=>Ir,STRINGCLEANORNOTHING:()=>Hr,STRINGCLEANORNULL:()=>Tr,STRINGEMAIL:()=>Pe,STRINGEMAILORNOTHING:()=>er,STRINGEMAILORNULL:()=>yr,STRINGHEX:()=>Ve,STRINGHEX128:()=>qe,STRINGHEX128ORNOTHING:()=>or,STRINGHEX128ORNULL:()=>vr,STRINGHEX256:()=>Ye,STRINGHEX256ORNOTHING:()=>ar,STRINGHEX256ORNULL:()=>wr,STRINGHEX32:()=>De,STRINGHEX32ORNOTHING:()=>nr,STRINGHEX32ORNULL:()=>pr,STRINGHEX512:()=>_e,STRINGHEX512ORNOTHING:()=>ur,STRINGHEX512ORNULL:()=>Nr,STRINGHEX64:()=>Fe,STRINGHEX64ORNOTHING:()=>ir,STRINGHEX64ORNULL:()=>gr,STRINGHEXORNOTHING:()=>rr,STRINGHEXORNULL:()=>dr,STRINGORNOTHING:()=>tr,STRINGORNULL:()=>hr,VALID:()=>Kr,addError:()=>nn,addType:()=>rn,createStringifyFunction:()=>Qr,createValidationFunction:()=>tn,errorMessageFor:()=>en,initialize:()=>un,lock:()=>an,overwriteType:()=>on});var f={};t.r(f),t.d(f,{initialize:()=>fn,onLoginSuccess:()=>cn,passwordReset:()=>ln,register:()=>hn,userLoginAuth:()=>sn});var s={};t.r(s),t.d(s,{decrypt:()=>ai,encrypt:()=>oi,getEntropySeed:()=>ii,getPublicKeyHex:()=>ti,getSignedNodeId:()=>ni,initialize:()=>Wn,isNotGod:()=>Qn,sign:()=>ei,verify:()=>ri});var c={};t.r(c),t.d(c,{addNewUser:()=>yi,getNewUserObject:()=>ci,getUserData:()=>hi,getUserList:()=>li,initialize:()=>ui,removeUserData:()=>pi,setUserData:()=>di});var l={};t.r(l);var h={};t.r(h),t.d(h,{prepareAndExpose:()=>Gi});var y={};t.r(y),t.d(y,{serviceStartup:()=>Ui});var d,p,g={};t.r(g),t.d(g,{initialize:()=>zi}),p=function(t){return JSON.stringify(t,null,4)},d={};var v,w,N=function(t){var e,r;return r=function(t){return e("\n"+p(t))},{log:e=function(e){d[t]&&console.log("["+t+"]: "+e)},olog:r}};({log:v,olog:w}=N("adminauthmodule"));var O,E,x,b=function(){v("initialize")},S=function(t,e){v("signatureAuth")},m=function(t){v("addServerSignature")};({log:O,olog:E}=N("sciregistrymodule")),x=Object.create(null);var A=function(){return Object.freeze(x)},R=function(){return x=null},I=function(t,e,r){if("string"!=typeof t)throw new Error("Route not a string!");if("function"!=typeof e)throw new Error("Func not a function!");if(null!=x[t])throw new Error("Cannot add route twice!");if(null==e)throw new Error("function must be defined!");null!=r&&"object"==typeof r||(r={}),x[t]={func:e,conf:r}};const{p:T,n:H,Gx:L,Gy:G,a:j,d:$}={p:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedn,n:0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3edn,h:8n,a:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecn,d:0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3n,Gx:0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,Gy:0x6666666666666666666666666666666666666666666666666666666666666658n},U=32,z=(t="")=>{throw new Error(t)},C=t=>"string"==typeof t,B=(t,e)=>!(t=>t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name)(t)||"number"==typeof e&&e>0&&t.length!==e?z("Uint8Array expected"):t,X=t=>new Uint8Array(t),J=t=>Uint8Array.from(t),M=(t,e)=>t.toString(16).padStart(e,"0"),k=t=>Array.from(B(t)).map(t=>M(t,2)).join(""),P=t=>t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:void 0,V=t=>{const e="hex invalid";if(!C(t))return z(e);const r=t.length,n=r/2;if(r%2)return z(e);const i=X(n);for(let r=0,o=0;r<n;r++,o+=2){const n=P(t.charCodeAt(o)),a=P(t.charCodeAt(o+1));if(void 0===n||void 0===a)return z(e);i[r]=16*n+a}return i},D=(t,e)=>B(C(t)?V(t):J(B(t)),e),F=()=>globalThis?.crypto,q=(...t)=>{const e=X(t.reduce((t,e)=>t+B(e).length,0));let r=0;return t.forEach(t=>{e.set(t,r),r+=t.length}),e},Y=(t=U)=>F().getRandomValues(X(t)),_=BigInt,K=(t,e,r,n="bad number: out of range")=>(t=>"bigint"==typeof t)(t)&&e<=t&&t<r?t:z(n),Z=(t,e=T)=>{const r=t%e;return r>=0n?r:e+r},W=t=>Z(t,H),Q=(t,e)=>{(0n===t||e<=0n)&&z("no inverse n="+t+" mod="+e);let r=Z(t,e),n=e,i=0n,o=1n,a=1n,u=0n;for(;0n!==r;){const t=n/r,e=n%r,f=i-a*t,s=o-u*t;n=r,r=e,i=a,o=u,a=f,u=s}return 1n===n?Z(i,e):z("no inverse")},tt=t=>t instanceof rt?t:z("Point expected"),et=2n**256n;class rt{static BASE;static ZERO;ex;ey;ez;et;constructor(t,e,r,n){const i=et;this.ex=K(t,0n,i),this.ey=K(e,0n,i),this.ez=K(r,1n,i),this.et=K(n,0n,i),Object.freeze(this)}static fromAffine(t){return new rt(t.x,t.y,1n,Z(t.x*t.y))}static fromBytes(t,e=!1){const r=$,n=J(B(t,U)),i=t[31];n[31]=-129&i;const o=at(n);K(o,0n,e?et:T);const a=Z(o*o),u=Z(a-1n),f=Z(r*a+1n);let{isValid:s,value:c}=st(u,f);s||z("bad point: y not sqrt");const l=1n==(1n&c),h=!!(128&i);return!e&&0n===c&&h&&z("bad point: x==0, isLastByteOdd"),h!==l&&(c=Z(-c)),new rt(c,o,1n,Z(c*o))}assertValidity(){const t=j,e=$;if(this.is0())throw new Error("bad point: ZERO");const{ex:r,ey:n,ez:i,et:o}=this,a=Z(r*r),u=Z(n*n),f=Z(i*i),s=Z(f*f),c=Z(a*t);if(Z(f*Z(c+u))!==Z(s+Z(e*Z(a*u))))throw new Error("bad point: equation left != right (1)");if(Z(r*n)!==Z(i*o))throw new Error("bad point: equation left != right (2)");return this}equals(t){const{ex:e,ey:r,ez:n}=this,{ex:i,ey:o,ez:a}=tt(t),u=Z(e*a),f=Z(i*n),s=Z(r*a),c=Z(o*n);return u===f&&s===c}is0(){return this.equals(it)}negate(){return new rt(Z(-this.ex),this.ey,this.ez,Z(-this.et))}double(){const{ex:t,ey:e,ez:r}=this,n=j,i=Z(t*t),o=Z(e*e),a=Z(2n*Z(r*r)),u=Z(n*i),f=t+e,s=Z(Z(f*f)-i-o),c=u+o,l=c-a,h=u-o,y=Z(s*l),d=Z(c*h),p=Z(s*h),g=Z(l*c);return new rt(y,d,g,p)}add(t){const{ex:e,ey:r,ez:n,et:i}=this,{ex:o,ey:a,ez:u,et:f}=tt(t),s=j,c=$,l=Z(e*o),h=Z(r*a),y=Z(i*c*f),d=Z(n*u),p=Z((e+r)*(o+a)-l-h),g=Z(d-y),v=Z(d+y),w=Z(h-s*l),N=Z(p*g),O=Z(v*w),E=Z(p*w),x=Z(g*v);return new rt(N,O,x,E)}multiply(t,e=!0){if(!e&&(0n===t||this.is0()))return it;if(K(t,1n,H),1n===t)return this;if(this.equals(nt))return xt(t).p;let r=it,n=nt;for(let i=this;t>0n;i=i.double(),t>>=1n)1n&t?r=r.add(i):e&&(n=n.add(i));return r}toAffine(){const{ex:t,ey:e,ez:r}=this;if(this.equals(it))return{x:0n,y:1n};const n=Q(r,T);return 1n!==Z(r*n)&&z("invalid inverse"),{x:Z(t*n),y:Z(e*n)}}toBytes(){const{x:t,y:e}=this.assertValidity().toAffine(),r=ot(e);return r[31]|=1n&t?128:0,r}toHex(){return k(this.toBytes())}clearCofactor(){return this.multiply(_(8n),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let t=this.multiply(H/2n,!1).double();return H%2n&&(t=t.add(this)),t.is0()}static fromHex(t,e){return rt.fromBytes(D(t),e)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}toRawBytes(){return this.toBytes()}}const nt=new rt(L,G,1n,Z(L*G)),it=new rt(0n,1n,1n,0n);rt.BASE=nt,rt.ZERO=it;const ot=t=>V(M(K(t,0n,et),64)).reverse(),at=t=>_("0x"+k(J(B(t)).reverse())),ut=(t,e)=>{let r=t;for(;e-- >0n;)r*=r,r%=T;return r},ft=0x2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0n,st=(t,e)=>{const r=Z(e*e*e),n=(t=>{const e=t*t%T*t%T,r=ut(e,2n)*e%T,n=ut(r,1n)*t%T,i=ut(n,5n)*n%T,o=ut(i,10n)*i%T,a=ut(o,20n)*o%T,u=ut(a,40n)*a%T,f=ut(u,80n)*u%T,s=ut(f,80n)*u%T,c=ut(s,10n)*i%T;return{pow_p_5_8:ut(c,2n)*t%T,b2:e}})(t*Z(r*r*e)).pow_p_5_8;let i=Z(t*r*n);const o=Z(e*i*i),a=i,u=Z(i*ft),f=o===t,s=o===Z(-t),c=o===Z(-t*ft);return f&&(i=a),(s||c)&&(i=u),1n==(1n&Z(i))&&(i=Z(-i)),{isValid:f||s,value:i}},ct=t=>W(at(t)),lt=(...t)=>vt.sha512Async(...t),ht=t=>{const e=t.slice(0,U);e[0]&=248,e[31]&=127,e[31]|=64;const r=t.slice(U,64),n=ct(e),i=nt.multiply(n),o=i.toBytes();return{head:e,prefix:r,scalar:n,point:i,pointBytes:o}},yt=t=>lt(D(t,U)).then(ht),dt=t=>yt(t).then(t=>t.pointBytes),pt=t=>lt(t.hashable).then(t.finish),gt={zip215:!0},vt={sha512Async:async(...t)=>{const e=F()?.subtle??z("crypto.subtle must be defined"),r=q(...t);return X(await e.digest("SHA-512",r.buffer))},sha512Sync:void 0,bytesToHex:k,hexToBytes:V,concatBytes:q,mod:Z,invert:Q,randomBytes:Y},wt=()=>Y(U),Nt=Math.ceil(32)+1;let Ot;const Et=(t,e)=>{const r=e.negate();return t?r:e},xt=t=>{const e=Ot||(Ot=(()=>{const t=[];let e=nt,r=e;for(let n=0;n<Nt;n++){r=e,t.push(r);for(let n=1;n<128;n++)r=r.add(e),t.push(r);e=r.double()}return t})());let r=it,n=nt;const i=_(255),o=_(8);for(let a=0;a<Nt;a++){let u=Number(t&i);t>>=o,u>128&&(u-=256,t+=1n);const f=128*a,s=f,c=f+Math.abs(u)-1,l=a%2!=0,h=u<0;0===u?n=n.add(Et(l,e[s])):r=r.add(Et(h,e[c]))}return{p:r,f:n}},bt=require("string_decoder");var St,mt,At,Rt;mt=new bt.StringDecoder("utf-8"),new Array(256).fill(0).map(function(t,e){return BigInt(e)}),Rt=Array.from("0123456789abcdef"),At=new Array(256),Rt.forEach(function(t){return At[t]=16*parseInt(t,16)}),St=new Array(256),Rt.forEach(function(t){return St[t]=parseInt(t,16)});var It=function(t){return new Uint8Array(Buffer.from(t,"utf8"))},Tt=function(t){return Buffer.from(t).toString("hex")},Ht=function(t){var e,r,n,i;for(i=new Uint8Array(t.length/2),e=r=0,n=t.length;r<n;e=r+=2)i[e/2]=At[t[e]]+St[t[e+1]];return i};const Lt=require("crypto");var Gt,jt,$t,Ut;jt="aes-256-cbc",Gt=BigInt(2)**BigInt(252)+BigInt("27742317777372353535851937790883648493"),$t=function(t){var e,r,n,i;return(r=t.slice(0,32))[0]&=248,r[31]&=127,r[31]|=64,n=new Uint8Array(r),i=Tt(n.reverse()),e=BigInt("0x"+i),Ut(e)},Ut=function(t,e=Gt){var r;return(r=t%e)>=0n?r:r+e};var zt,Ct,Bt=function(t){var e;return(e=Lt.createHash("sha512")).update(t),e.digest("hex")},Xt=function(t){var e;return(e=Lt.createHash("sha512")).update(t),e.digest()},Jt=async function(t,e){var r,n,i;return r=It(t),i=Ht(e),n=await(async(t,e)=>{const r=D(t),n=await yt(e),i=await lt(n.prefix,r);return pt(((t,e,r)=>{const{pointBytes:n,scalar:i}=t,o=ct(e),a=nt.multiply(o).toBytes();return{hashable:q(a,n,r),finish:t=>{const e=W(o+ct(t)*i);return B(q(a,ot(e)),64)}}})(n,i,r))})(r,i),Tt(n)},Mt=async function(t,e,r){var n,i,o;return o=Ht(t),i=Ht(e),n=It(r),await(async(t,e,r,n=gt)=>pt(((t,e,r,n=gt)=>{t=D(t,64),e=D(e),r=D(r,U);const{zip215:i}=n;let o,a,u,f,s=Uint8Array.of();try{o=rt.fromHex(r,i),a=rt.fromHex(t.slice(0,U),i),u=at(t.slice(U,64)),f=nt.multiply(u,!1),s=q(a.toBytes(),o.toBytes(),e)}catch(t){}return{hashable:s,finish:t=>{if(null==f)return!1;if(!i&&o.isSmallOrder())return!1;const e=ct(t);return a.add(o.multiply(e,!1)).add(f.negate()).clearCofactor().is0()}}})(t,e,r,n)))(o,n,i)},kt=async function(t,e){var r,n,i,o,a,u;return n=rt.fromHex(e),u=wt(),a=$t(Xt(u)),r=await dt(u),o=n.multiply(a),i=function(t,e){var r,n,i,o,a,u;return a=e.substring(0,32),o=Buffer.from(a,"hex"),n=e.substring(32,96),r=Buffer.from(n,"hex"),u=Dt(t),(i=Lt.createCipheriv(jt,r,o)).update(u,null,"hex")+i.final("hex")}(t,Bt(o.toRawBytes())),{referencePointHex:Tt(r),encryptedContentHex:i}},Pt=function(t,e){var r,n,i,o,a;if(r=t.referencePointHex||t.referencePoint,i=t.encryptedContentHex||t.encryptedContent,null==r||null==i)throw new Error("Invalid secrets Object!");return n=Ht(e),a=$t(Xt(n)),o=rt.fromHex(r).multiply(a),function(t,e){var r,n,i,o,a,u,f,s,c,l,h,y,d,p;if(c=e.substring(0,32),s=Buffer.from(c,"hex"),n=e.substring(32,96),r=Buffer.from(n,"hex"),p=(a=Lt.createDecipheriv(jt,r,s)).update(t,"hex"),0===(u=a.final()).length)return Ft(p);for(i=new Uint8Array(p.length+u.length),f=l=0,y=Dt.length;l<y;f=++l)o=Dt[f],i[f]=o;for(f=h=0,d=u.length;h<d;f=++h)o=u[f],i[p.length+f]=o;return Ft(i)}(i,Bt(o.toRawBytes()))},Vt=function(t,e,r=""){var n,i,o,a,u,f,s,c,l,h,y;for(n=Ht(t),c=$t(Xt(n)),s=rt.fromHex(e).multiply(c).toRawBytes(),o=It(r),y=new Uint8Array(s.length+o.length),a=u=0,l=s.length;u<l;a=++u)i=s[a],y[a]=i;for(a=f=0,h=o.length;f<h;a=++f)i=o[a],y[s.length+a]=i;return Bt(y)},Dt=function(t){var e,r,n,i,o,a,u,f,s,c,l,h,y,d;for(r=(t=It(t)).length,h=33+(127&Lt.randomBytes(1)[0]),l=Lt.randomBytes(h),i=(d=(s=h+3)+r)+(f=32-d%32),c=new Uint8Array(i),o=a=0,u=t.length;a<u;o=++a)e=t[o],c[o+s]=e;for(y=0,o=32;o--;)y+=l[o],c[o]=l[o];for(c[h+2]=f,o=0,n=i-1;o<f;)c[n-o]=l[o],o++;for(o=32;o<h;)l[o+1]+=y===256*l[o]+l[o+1],y+=l[o],c[o]=l[o],o++;return c[h]=y>>8,c[h+1]=y%256,c[h]===c[h-1]&&c[h+1]===2*c[h]&&(c[h-1]++,y++,c[h]=y>>8,c[h+1]=y%256),c},Ft=function(t){var e,r,n,i,o,a,u,f,s,c;for(a=(o=(r=t.length)>160?160:r)+1,s=0,n=32;n--;)s+=t[n];for(n=32;n<a;){if(s===256*t[n]+t[n+1]){f=n+3,u=t[n+2];break}s+=t[n],n++}if(n>o)throw new Error("Unsalt: No valid prefix ending found!");for(n=0,e=r-1,i=0;n<u;)i+=t[n]!==t[e-n],n++;if(i)throw new Error("Unsalt: Postfix and prefix did not match as expected!");return e=r-u,t=t.slice(f,e),c=new Uint8Array(t),mt.end(c)};({log:zt,olog:Ct}=N("authutilmodule"));var qt,Yt,_t=function(){zt("initialize")},Kt=async function(t){return zt("getPasswordHash"),await(e=t,(r=Lt.createHash("sha256")).update(e),r.digest("hex"));var e,r},Zt=72e5,Wt={basePath:"../state",maxCacheSize:128};(function(t){var e;for(e in t)t[e]&&(d[e]=!0)})({schemamodule:!0,authorizationmodule:!0,scimodule:!0}),({log:qt,olog:Yt}=N("errormodule"));var Qt,te,ee,re,ne,ie,oe,ae,ue,fe,se,ce,le,he,ye,de,pe,ge,ve,we,Ne,Oe,Ee,xe,be,Se,me,Ae,Re,Ie,Te,He,Le,Ge,je,$e,Ue,ze,Ce,Be,Xe,Je=function(){qt("initialize")},Me=function(t){throw new Error(t)};({log:Ne,olog:Re}=N("schemamodule"));var ke=1,Pe=2,Ve=3,De=4,Fe=5,qe=6,Ye=7,_e=8,Ke=9,Ze=10,We=11,Qe=12,tr=13,er=14,rr=15,nr=16,ir=17,or=18,ar=19,ur=20,fr=21,sr=22,cr=23,lr=24,hr=25,yr=26,dr=27,pr=28,gr=29,vr=30,wr=31,Nr=32,Or=33,Er=34,xr=35,br=36,Sr=37,mr=38,Ar=39,Rr=40,Ir=41,Tr=42,Hr=43,Lr=44,Gr=45,jr=46;Be=new Array(47),Ce=new Array(47),Be[ke]=function(t){if("string"!=typeof t)return $r},Be[Pe]=function(t){var e,r,n,i,o,a,u,f;if("string"!=typeof t)return $r;if(t.length>320||t.length<5)return Mr;if(de.test(t))return Jr;if((e=t.indexOf("@"))<=0||e>64||t.length-e<4||"."===t[0]||"."===t[e-1]||"-"===t[0]||"-"===t[e-1]||"."===t[e+1]||"-"===t[e+1])return Jr;for(i=o=0,u=t.length;o<u;i=++o)if(r=t[i],!(fe[r]||i===e||i<e&&("+"===r||"_"===r)))return Jr;if("."===t[t.length-1]||"-"===t[t.length-1])return Jr;if(a=e,(n=t.indexOf(".",e+1))<0)return Jr;for(;n>0;){if(n-a>63)return Jr;a=n,n=t.indexOf(".",a+1)}return f=t.slice(a+1),Se.test(f)?Jr:void 0},Be[Ve]=function(t){var e,r,n;if("string"!=typeof t)return $r;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr},Be[De]=function(t){var e,r,n;if("string"!=typeof t)return $r;if(32!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr},Be[Fe]=function(t){var e,r,n;if("string"!=typeof t)return $r;if(64!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr},Be[qe]=function(t){var e,r,n;if("string"!=typeof t)return $r;if(128!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr},Be[Ye]=function(t){var e,r,n;if("string"!=typeof t)return $r;if(256!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr},Be[_e]=function(t){var e,r,n;if("string"!=typeof t)return $r;if(512!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr},Be[Ke]=function(t){return"number"!=typeof t?Ur:NaN===t?kr:Infinity===t||-Infinity===t?Yr:void 0},Be[Ze]=function(t){if("boolean"!=typeof t)return zr},Be[We]=function(t){if(!Array.isArray(t))return Cr},Be[Qe]=function(t){if("object"!=typeof t)return Br},Be[tr]=function(t){if(void 0!==t)return"string"!=typeof t?$r:void 0},Be[er]=function(t){var e,r,n,i,o,a,u,f;if(void 0!==t){if("string"!=typeof t)return $r;if(t.length>320||t.length<5)return Mr;if(de.test(t))return Jr;if((e=t.indexOf("@"))<=0||e>64||t.length-e<4||"."===t[0]||"."===t[e-1]||"-"===t[0]||"-"===t[e-1]||"."===t[e+1]||"-"===t[e+1])return Jr;for(i=o=0,u=t.length;o<u;i=++o)if(r=t[i],!(fe[r]||i===e||i<e&&("+"===r||"_"===r)))return Jr;if("."===t[t.length-1]||"-"===t[t.length-1])return Jr;if(a=e,(n=t.indexOf(".",e+1))<0)return Jr;for(;n>0;){if(n-a>63)return Jr;a=n,n=t.indexOf(".",a+1)}return f=t.slice(a+1),Se.test(f)?Jr:void 0}},Be[rr]=function(t){var e,r,n;if(void 0!==t){if("string"!=typeof t)return $r;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[nr]=function(t){var e,r,n;if(void 0!==t){if("string"!=typeof t)return $r;if(32!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[ir]=function(t){var e,r,n;if(void 0!==t){if("string"!=typeof t)return $r;if(64!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[or]=function(t){var e,r,n;if(void 0!==t){if("string"!=typeof t)return $r;if(128!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[ar]=function(t){var e,r,n;if(void 0!==t){if("string"!=typeof t)return $r;if(256!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[ur]=function(t){var e,r,n;if(void 0!==t){if("string"!=typeof t)return $r;if(512!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[fr]=function(t){if(void 0!==t)return"number"!=typeof t?Ur:NaN===t?kr:Infinity===t||-Infinity===t?Yr:void 0},Be[sr]=function(t){if(void 0!==t)return"boolean"!=typeof t?zr:void 0},Be[cr]=function(t){if(void 0!==t)return Array.isArray(t)?void 0:Cr},Be[lr]=function(t){if(void 0!==t)return"object"!=typeof t?Br:void 0},Be[hr]=function(t){if(null!==t)return"string"!=typeof t?$r:void 0},Be[yr]=function(t){var e,r,n,i,o,a,u,f;if(null!==t){if("string"!=typeof t)return $r;if(t.length>320||t.length<5)return Mr;if(de.test(t))return Jr;if((e=t.indexOf("@"))<=0||e>64||t.length-e<4||"."===t[0]||"."===t[e-1]||"-"===t[0]||"-"===t[e-1]||"."===t[e+1]||"-"===t[e+1])return Jr;for(i=o=0,u=t.length;o<u;i=++o)if(r=t[i],!(fe[r]||i===e||i<e&&("+"===r||"_"===r)))return Jr;if("."===t[t.length-1]||"-"===t[t.length-1])return Jr;if(a=e,(n=t.indexOf(".",e+1))<0)return Jr;for(;n>0;){if(n-a>63)return Jr;a=n,n=t.indexOf(".",a+1)}return f=t.slice(a+1),Se.test(f)?Jr:void 0}},Be[dr]=function(t){var e,r,n;if(null!==t){if("string"!=typeof t)return $r;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[pr]=function(t){var e,r,n;if(null!==t){if("string"!=typeof t)return $r;if(32!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[gr]=function(t){var e,r,n;if(null!==t){if("string"!=typeof t)return $r;if(64!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[vr]=function(t){var e,r,n;if(null!==t){if("string"!=typeof t)return $r;if(128!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[wr]=function(t){var e,r,n;if(null!==t){if("string"!=typeof t)return $r;if(256!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[Nr]=function(t){var e,r,n;if(null!==t){if("string"!=typeof t)return $r;if(512!==t.length)return Mr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr}},Be[Or]=function(t){if(null!==t)return"number"!=typeof t?Ur:NaN===t?kr:Infinity===t||-Infinity===t?Yr:void 0},Be[Er]=function(t){if(null!==t)return"boolean"!=typeof t?zr:void 0},Be[xr]=function(t){if(null!==t)return Array.isArray(t)?void 0:Cr},Be[br]=function(t){return"object"!=typeof t?Br:null===t?Pr:void 0},Be[Sr]=function(t){return"string"!=typeof t?$r:0===t.length?Vr:void 0},Be[mr]=function(t){return Array.isArray(t)?0===t.length?Dr:void 0:Cr},Be[Ar]=function(t){var e,r,n;if("string"!=typeof t)return $r;if(0===t.length)return Vr;for(r=0,n=t.length;r<n;r++)if(e=t[r],!ye[e])return Xr},Be[Rr]=function(t){var e,r,n;if("string"!=typeof t)return $r;if(0===t.length)return Vr;for(r=0,n=t.length;r<n;r++)if(e=t[r],ue[e])return Fr},Be[Ir]=function(t){var e,r,n;if("string"!=typeof t)return $r;for(r=0,n=t.length;r<n;r++)if(e=t[r],ue[e])return Fr},Be[Tr]=function(t){var e,r,n;if(null!==t){if("string"!=typeof t)return $r;for(r=0,n=t.length;r<n;r++)if(e=t[r],ue[e])return Fr}},Be[Hr]=function(t){var e,r,n;if(void 0!==t){if("string"!=typeof t)return $r;for(r=0,n=t.length;r<n;r++)if(e=t[r],ue[e])return Fr}},Be[Lr]=function(t){return"object"!=typeof t?Br:pe(t)?qr:void 0},Be[Gr]=function(t){return"object"!=typeof t?Br:null===t?Pr:pe(t)?qr:void 0},Be[jr]=function(t){if(void 0!==t)return"object"!=typeof t?Br:pe(t)?qr:void 0},re=function(t){return t?"true":"false"},te=function(t){return void 0===t?t:t?"true":"false"},ee=function(t){return null===t?"null":t?"true":"false"},be=function(t){return""+t},Ee=function(t){return void 0===t?t:""+t},xe=function(t){return null===t?"null":""+t},Le=function(t){return'"'+t+'"'},Te=function(t){return void 0===t?t:'"'+t+'"'},He=function(t){return null===t?"null":'"'+t+'"'},Ae=JSON.stringify,me=function(t){return void 0===t?t:JSON.stringify(t)},Ce[ke]=Le,Ce[Pe]=Le,Ce[Ve]=Le,Ce[De]=Le,Ce[Fe]=Le,Ce[qe]=Le,Ce[Ye]=Le,Ce[_e]=Le,Ce[Ke]=be,Ce[Ze]=re,Ce[We]=Ae,Ce[Qe]=Ae,Ce[tr]=Te,Ce[er]=Te,Ce[rr]=Te,Ce[nr]=Te,Ce[ir]=Te,Ce[or]=Te,Ce[ar]=Te,Ce[ur]=Te,Ce[fr]=Ee,Ce[sr]=te,Ce[cr]=me,Ce[lr]=me,Ce[hr]=He,Ce[yr]=He,Ce[dr]=He,Ce[pr]=He,Ce[gr]=He,Ce[vr]=He,Ce[wr]=He,Ce[Nr]=He,Ce[Or]=xe,Ce[Er]=ee,Ce[xr]=Ae,Ce[br]=Ae,Ce[Sr]=Le,Ce[mr]=Ae,Ce[Ar]=Le,Ce[Rr]=Le,Ce[Ir]=Le,Ce[Tr]=Le,Ce[Hr]=Le,Ce[Lr]=Ae,Ce[Gr]=Ae,Ce[jr]=Ae;var $r=1001,Ur=1002,zr=1003,Cr=1004,Br=1005,Xr=1006,Jr=1007,Mr=1008,kr=1009,Pr=1010,Vr=1011,Dr=1012,Fr=1013,qr=1014,Yr=1015,_r=2222,Kr=0;for((Qt=Object.create(null))[$r]="Not a String!",Qt[Ur]="Not a Number!",Qt[zr]="Not a Boolean!",Qt[Cr]="Not an Array!",Qt[Br]="Not an Object!",Qt[Xr]="String is not valid hex!",Qt[Jr]="String is not a valid email!",Qt[Mr]="String size mismatch!",Qt[kr]="Number is NaN!",Qt[Pr]="Object is null!",Qt[Vr]="String is empty!",Qt[Dr]="Array is empty!",Qt[Fr]="String is dirty!",Qt[qr]="Object is dirty!",Qt[Yr]="Number is infinity!",Qt[_r]="Schema is invalid!",pe=function(t){var e,r,n,i;if(null!==t){for(e=0,i=(n=Object.keys(t)).length;e<i;e++){if("__proto__"===(r=n[e])||"constructor"===r||"prototype"===r)return!0;if("object"==typeof t[r]&&pe(t[r]))return!0}return!1}},Ge=function(t){return function(e){if(e!==t)return _r}},je=function(t){var e;if(null==(e=Ce[t]))throw new Error(`Unrecognized Schematype! (${t})`);return e},Xe=function(t){var e;if(null==(e=Be[t]))throw new Error(`Unrecognized Schematype! (${t})`);return e},oe=function(t){var e,r;if(0===t.length)throw new Error("[] is illegal!");return r=he(t),e=function(t){var e,n,i,o,a,u,f;if(!Array.isArray(t))return _r;for(o=0,a=u=0,f=r.length;u<f;a=++u)if(i=r[a],null!=(e=t[a])&&o++,n=i(e))return n;return t.length>o?_r:void 0},e},ae=function(t){var e,r;if(null===t)throw new Error("null is illegal!");if(0===(r=le(t)).length)throw new Error("{} is illegal!");return e=function(t){var e,n,i,o,a,u;if("object"!=typeof t)return _r;if(null===t)return _r;for(i=0,o=0,a=r.length;o<a;o++)if(null!=(u=t[(e=r[o])[0]])&&i++,n=e[1](u))return n;return Object.keys(t).length>i?_r:void 0},e},he=function(t){var e,r,n,i,o;for(r=new Array(t.length),n=i=0,o=t.length;i<o;n=++i)switch(e=t[n],!1){case"number"!=typeof e:r[n]=Xe(e);break;case"string"!=typeof e:r[n]=Ie(e);break;case"object"==typeof e:throw new Error(`Illegal ${typeof e}!`);case!Array.isArray(e):r[n]=oe(e);break;default:r[n]=ae(e)}return r},le=function(t){var e,r,n,i,o,a,u,f;for(u=[],e=r=0,o=(i=Object.keys(t)).length;r<o;e=++r)if("number"!=typeof(a=t[n=i[e]]))if("string"!=typeof a){if("object"!=typeof a)throw new Error(`Illegal ${typeof a}!`);Array.isArray(a)?(f=oe(a),u.push([n,f])):(f=ae(a),u.push([n,f]))}else u.push([n,Ie(a)]);else u.push([n,Xe(a)]);return u},ne=function(t){var e,r,n,i;return i=se(t),e=i.length,r=new Array(e),n=function(t){var n,o,a,u,f,s,c;for(o=a=0,f=i.length;a<f;o=++a)n=i[o],r[o]=n(t[o]);for(;void 0===r[r.length-1]&&0!==r.length;)r.pop();if(0===r.length)return r.length=e,"[]";for(o=u=0,s=r.length;u<s;o=++u)void 0===r[o]&&(r[o]="null");for(c="["+r[0],o=1;o<r.length;)c+=","+r[o++];return r.length=e,c+"]"},n},ie=function(t){var e,r,n,i;return i=ce(t),e=i.length,r=new Array(e),n=function(t){var n,o,a,u,f;for(o=a=0,u=i.length;a<u;o=++a)n=i[o],r[o]=n[1](t[n[0]]);for(f="{",o=0;1===f.length&&o<e;)null!=r[o]&&(f+='"'+i[o][0]+'":'+r[o]),o++;for(;o<e;)null!=r[o]&&(f+=',"'+i[o][0]+'":'+r[o]),o++;return f+"}"},n},se=function(t){var e,r,n,i,o,a;for(o=new Array(t.length),r=n=0,i=t.length;n<i;r=++n)"number"==(a=typeof(e=t[r]))&&(o[r]=je(e)),"string"===a&&(o[r]=je(ke)),"object"===a&&(Array.isArray(e)?o[r]=ne(e):o[r]=ie(e));return o},ce=function(t){var e,r,n,i,o,a,u,f;for(i=Object.keys(t),u=new Array(i.length),e=r=0,o=i.length;r<o;e=++r)"number"==(f=typeof(a=t[n=i[e]]))&&(u[e]=[n,je(a)]),"string"===f&&(u[e]=[n,je(ke)]),"object"===f&&(Array.isArray(a)?u[e]=[n,ne(a)]:u[e]=[n,ie(a)]);return u},Ie=null,we=!1,Se=/^\d+$/,de=/(\.\.|--|-\.)|\.-/,ye=Object.create(null),ge=0;ge<22;ge++)ye["0123456789abcdefABCDEF"[ge]]=!0;for(fe=Object.create(null),ve=0;ve<64;ve++)fe["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-."[ve]]=!0;for(ue=Object.create(null),Oe=0;Oe<67;Oe++)ue["\0\b\v\fÂ áš€á Žâ€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€‹â€Œâ€â€Žâ€\u2028\u2029â€ªâ€«â€¬â€­â€®â â¡â¢â£â¤â¦â§â¨â©ã€€\ufeff"[Oe]]=!0;var Zr,Wr,Qr=function(t){var e;return"number"==(e=typeof t)?je(t):"string"===e?je(ke):Array.isArray(t)?ne(t):ie(t)},tn=function(t,e){var r;if(Ie=e?Ge:function(t){throw new Error("Illegal string!")},"number"==(r=typeof t))return Xe(t);if("string"===r)return Ie(t);if("object"!==r)throw new Error(`Illegal ${typeof t}!`);return Array.isArray(t)?oe(t):ae(t)},en=function(t){var e;return"string"!=typeof(e=Qt[t])?"":e},rn=function(t,e){var r;if(Ne("addType not implemented yet!"),we)throw new Error("We are closed!");if((r=Be.length)>=1e3)throw new Error("Exeeding type limit!");return Be[r]=t,Ce[r]=e,r},nn=function(t,e){if(Ne("addError"),we)throw new Error("We are closed!");if("number"!=typeof t)throw new Error("Code not a Number!");if(t<1e3||t>=2e3)throw new Error("Invalid code!");if("string"!=typeof e)throw new Error("Message not a String!");if(null!=Qt[t])throw new Error("Already exists!");Qt[t]=e},on=function(t,e,r){if(Ne("overwriteType not implemented yet!"),we)throw new Error("We are closed!");if(t>=Be.length)throw new Error("Does not exist!");Be[t]=validatorFunc},an=function(){Ne("lock"),we=!0,Object.freeze(Be),Object.freeze(Ce),Object.freeze(Qt)},un=function(){var t,e,r,n,i,o,a,u,f,s;for(Ne("initialize"),e=i=0,n=ze.length;i<n;e=++i){u=ze[e];try{s=tn(u,!0)}catch(r){Ne(`@${e} createValidationFunction failed!\n${(t=r).message}`)}try{f=Qr(u)}catch(r){Ne(`@${e} createStringifyFunction failed!\n${(t=r).message}`)}try{t=s(o=Ue[e]),Ne(t?`@${e}: validation failed!`:`@${e}: validation succeeded!`),r=JSON.stringify(o),a=null,a=f(o),Ne(`jsonString: ${r}`),Ne(`ownString: ${a}`)}catch(r){Ne(`@${e}Testing failed!\n${(t=r).message}`)}null==a&&Ne(f.toString())}};($e=Object.create(null)).STRING=ke,$e.STRINGEMAIL=Pe,$e.STRINGHEX=Ve,$e.STRINGHEX32=De,$e.STRINGHEX64=Fe,$e.STRINGHEX128=qe,$e.STRINGHEX256=Ye,$e.STRINGHEX512=_e,$e.NUMBER=Ke,$e.BOOLEAN=Ze,$e.ARRAY=We,$e.OBJECT=Qe,$e.STRINGORNOTHING=tr,$e.STRINGEMAILORNOTHING=er,$e.STRINGHEXORNOTHING=rr,$e.STRINGHEX32ORNOTHING=nr,$e.STRINGHEX64ORNOTHING=ir,$e.STRINGHEX128ORNOTHING=or,$e.STRINGHEX256ORNOTHING=ar,$e.STRINGHEX512ORNOTHING=ur,$e.NUMBERORNOTHING=fr,$e.BOOLEANORNOTHING=sr,$e.ARRAYORNOTHING=cr,$e.OBJECTORNOTHING=lr,$e.STRINGORNULL=hr,$e.STRINGEMAILORNULL=yr,$e.STRINGHEXORNULL=dr,$e.STRINGHEX32ORNULL=pr,$e.STRINGHEX64ORNULL=gr,$e.STRINGHEX128ORNULL=vr,$e.STRINGHEX256ORNULL=wr,$e.STRINGHEX512ORNULL=Nr,$e.NUMBERORNULL=Or,$e.BOOLEANORNULL=Er,$e.ARRAYORNULL=xr,$e.NONNULLOBJECT=br,$e.NONEMPTYSTRING=Sr,$e.NONEMPTYARRAY=mr,$e.NONEMPTYSTRINGHEX=Ar,$e.NONEMPTYSTRINGCLEAN=Rr,$e.STRINGCLEAN=Ir,$e.STRINGCLEANORNULL=Tr,$e.STRINGCLEANORNOTHING=Hr,$e.OBJECTCLEAN=Lr,$e.NONNULLOBJECTCLEAN=Gr,$e.OBJECTCLEANORNOTHING=jr,Ue=[],(ze=[]).push(Qe),Ue.push({}),ze.push([fr]),Ue.push([]),ze.push({email:er}),Ue.push({}),ze.push([Ke,Ke,Ke,er]),Ue.push([1,1,1,"email@alli.li"]),ze.push({email:Pe,name:ke,sub:{okay:Ze}}),Ue.push({email:"alfred@moser.de",name:"alfi",sub:{okay:!0}}),ze.push({email:Pe,name:ke,sub:[fr,fr,fr,fr]}),Ue.push({email:"alfred@moser.de",name:"alfi",sub:[2,3]}),"a".repeat(1024),"a".repeat(257),"a".repeat(257),"a".repeat(32),"A".repeat(32),"0".repeat(31),"f".repeat(33),"a".repeat(257),"a".repeat(64),"A".repeat(64),"f".repeat(63),"f".repeat(65),"f".repeat(62),"a".repeat(257),"a".repeat(128),"A".repeat(128),"f".repeat(127),"f".repeat(129),"a".repeat(257),"a".repeat(256),"f".repeat(255),"f".repeat(257),"a".repeat(257),"a".repeat(512),"f".repeat(511),"f".repeat(513),new Array(0),new Array(100).fill("a"),Object.create(null),"a".repeat(1024),"a".repeat(257),"a".repeat(257),"a".repeat(32),"A".repeat(32),"s".repeat(32),"x".repeat(32),"0".repeat(31),"f".repeat(33),"a".repeat(257),"a".repeat(64),"A".repeat(64),"x".repeat(64),"f".repeat(63),"f".repeat(65),"f".repeat(62),"a".repeat(257),"a".repeat(128),"A".repeat(128),"s".repeat(128),"x".repeat(128),"f".repeat(127),"f".repeat(129),"a".repeat(128),"a".repeat(257),"a".repeat(256),"x".repeat(256),"f".repeat(255),"f".repeat(257),"a".repeat(256),"a".repeat(257),"a".repeat(512),"x".repeat(512),"f".repeat(511),"f".repeat(513),"a".repeat(512),new Array(0),new Array(100).fill("a"),Object.create(null),"a".repeat(1024),"a".repeat(257),"a".repeat(257),"a".repeat(32),"A".repeat(32),"s".repeat(32),"a".repeat(33),"a".repeat(31),"a".repeat(257),"a".repeat(64),"b".repeat(64),"A".repeat(64),"s".repeat(64),"X".repeat(64),"a".repeat(63),"a".repeat(65),"a".repeat(257),"a".repeat(128),"A".repeat(128),"f".repeat(128),"x".repeat(128),".".repeat(128),"\n".repeat(128),"\0".repeat(128),"f".repeat(127),"f".repeat(129),"a".repeat(257),"a".repeat(256),"f".repeat(256),"x".repeat(256),".".repeat(256),"\n".repeat(256),"\0".repeat(256),"f".repeat(255),"f".repeat(257),"a".repeat(257),"a".repeat(512),"f".repeat(512),"x".repeat(512),".".repeat(512),"\n".repeat(512),"\0".repeat(512),"f".repeat(511),"f".repeat(513),new Array(0),new Array(100).fill("a"),Object.create(null),"a".repeat(1024),new Array(0),new Array(100).fill("a"),"a".repeat(257),"a".repeat(1024),"a".repeat(1024),"a".repeat(1024),"a".repeat(1024),Object.create(null),Object.create(null),Object.create(null),({log:Zr,olog:Wr}=N("userauthmodule"));var fn=function(){Zr("initialize")},sn=function(t,e){Zr("userLoginAuth")},cn=function(t){return Zr("onLoginSuccess"),Wr(t),{authCode:"",validUntil:Date.now()}},ln=function(t){Zr("passwordReset"),Wr(t)},hn=function(t){Zr("register"),Wr(t)};const yn=require("path"),dn=require("fs");var pn,gn,vn,wn,Nn,On;vn=dn.promises,gn=null;var En,xn,bn,Sn,mn,An,Rn,In,Tn,Hn,Ln,Gn,jn,$n,Un=function(t){var e;null==t&&(t="./state"),e=yn.isAbsolute(t)?t:yn.resolve(process.cwd(),t),gn=e,dn.existsSync(gn)||dn.mkdirSync(gn)};Nn=function(t){var e;return e=t+".json",yn.resolve(gn,e)},wn=function(t){return t+".backup"},pn=function(t){var e,r;e=wn(t);try{dn.copyFileSync(t,e)}catch(e){throw r="Error: backing up state failed!\n",r+="file: "+t+"\n",r+="reason: "+e.message,new Error(r)}},On=function(t){var e,r,n,i;i=Nn(t),e=wn(i);try{return r=dn.readFileSync(e,"utf-8"),n=JSON.parse(r),vn.writeFile(i,r),{contentObj:n,contentJson:r}}catch(t){return{contentObj:n=null,contentJson:r=null}}},jn=function(t){return JSON.stringify(t,null,4)},In={},Gn={},xn=null,Sn=null,Rn={},bn=0,Ln=64,An=null;var zn=function(t){t?(An=t.defaultState,null!=t.maxCacheSize&&(Ln=t.maxCacheSize),Un(t.basePath)):Un()};En=class{constructor(t){this.id=t,this.nextEntry=null,this.previousEntry=xn,null==Sn&&(Sn=this),null!=xn&&(xn.nextEntry=this),xn=this,Rn[this.id]=this,++bn>Ln&&mn()}touch(){null!=this.nextEntry&&(null!=this.previousEntry?(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry):(Sn=this.nextEntry,this.nextEntry.previousEntry=null),this.nextEntry=null,this.previousEntry=xn,null!=xn&&(xn.nextEntry=this),xn=this)}remove(){return null!=this.nextEntry&&null!=this.previousEntry&&(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry),null==this.nextEntry&&null==this.previousEntry&&(xn=null,Sn=null),null!=this.nextEntry&&null==this.previousEntry&&(this.nextEntry.previousEntry=null,Sn=this.nextEntry),null==this.nextEntry&&null!=this.previousEntry&&(this.previousEntry.nextEntry=null,xn=this.previousEntry),$n(this.id)}toString(){var t;return t=this.id+"\n",null!=this.nextEntry?t+="  next: "+this.nextEntry.id+"\n":t+="  next: null\n",null!=this.previousEntry?t+="  previous: "+this.previousEntry.id+"\n":t+="  previous: null\n",t}},Tn=function(t){var e,r;new En(t),({contentObj:r,contentJson:e}=function(t){var e,r;r=Nn(t);try{return e=dn.readFileSync(r,"utf-8"),{contentObj:JSON.parse(e),contentJson:e}}catch(e){return On(t)}}(t)),null!=r?(In[t]=e,Gn[t]=r):Hn(t)},Hn=function(t){null==An||null==An[t]?(In[t]="{}",Gn[t]={}):(In[t]=jn(An[t]),Gn[t]=JSON.parse(In[t]))},$n=function(t){delete Gn[t],delete In[t],delete Rn[t],bn--},mn=function(){var t;null!=(t=Sn)&&(null!=(Sn=t.nextEntry)&&(Sn.previousEntry=null),$n(t.id))};var Cn=async function(t,e){var r;null!=Rn[t]?Rn[t].touch():new En(t),e&&(Gn[t]=e),(r=jn(Gn[t]))!==In[t]&&(In[t]=r,await function(t,e){var r;r=Nn(t),dn.writeFileSync(r,e),pn(r)}(t,r))},Bn=function(t){return null==Gn[t]?Tn(t):Rn[t].touch(),Gn[t]};var Xn,Jn,Mn,kn,Pn,Vn,Dn=class{constructor(t){this.key=t.secretKeyHex,this.id=t.publicKeyHex,this.ctx=t.context,null==this.ctx&&(this.ctx="standard ThingyCryptoNode")}async sign(t){return await Jt(t,this.key)}async verify(t,e){return await Mt(t,this.id,e)}async encrypt(t){return await kt(t,this.id)}async decrypt(t){return await Pt(t,this.key)}async diffieHellmanFor(t,e,r){var n;return n=`${e}:${this.ctx}_${r}`,await Vt(this.key,t,n)}};({log:Jn,olog:Mn}=N("servicekeysmodule")),zn(),Pn=null,Xn=null,Vn=null,kn=new Promise(function(t){return Vn=t});var Fn,qn,Yn,_n,Kn,Zn,Wn=async function(){var t,e;Jn("initialize"),(Pn=Bn("serviceState")).secretKeyHex||(t=await async function(){var t,e;return e=wt(),t=await dt(e),{secretKeyHex:Tt(e),publicKeyHex:Tt(t)}}(),Pn.secretKeyHex=t.secretKeyHex,Pn.publicKeyHex=t.publicKeyHex,Cn("serviceState")),e={secretKeyHex:Pn.secretKeyHex,publicKeyHex:Pn.publicKeyHex,context:"thingy-rpc-post-connection"},Xn=new Dn(e),Vn(!0)},Qn=function(t){return null!==t},ti=function(){return Xn.id},ei=async function(t){return await kn,await Xn.sign(t)},ri=async function(t,e){return await kn,await Xn.verify(t,e)},ni=async function(){var t,e,r;return Jn("getSignedNodeId"),await kn,Jn("we are ready!"),(e={}).serverNodeId=Pn.publicKeyHex,e.timestamp=(r=Date.now())-r%18e4,t=JSON.stringify(e),e.signature=await ei(t),e},ii=async function(t,e,r){return await kn,await Xn.diffieHellmanFor(t,e,r)},oi=async function(t){return await kn,await Xn.encrypt(JSON.stringify(t))},ai=async function(t){return await kn,JSON.parse(await Xn.decrypt(t))};({log:Fn,olog:qn}=N("userdatamodule")),Kn={},_n={};var ui=async function(){var t;if(Fn("initialize"),null!=(Kn=Bn("userDataStore")).meta)try{await Zn()}catch(e){t=e,console.error(`Corrupted userDataStore!\n${t.message}`),process.exit(78)}else Kn.meta={};if(null!=Kn.encrypted)try{_n=await ai(Kn.encrypted)}catch(e){Fn(t=e)}qn(_n)};Zn=async function(){var t,e,r;if(Fn("validateUserDataStore"),!(e=(t=Kn.meta).serverSig))throw new Error("No signature in userDataStore.meta !");if(t.serverSig="",r=JSON.stringify(Kn),t.serverSig=e,!await ri(e,r))throw new Error("Invalid Signature in authCodestore.meta !")},Yn=async function(){var t,e;Fn("signAndSaveUserDataStore"),Kn.meta.serverSig="",Kn.meta.serverPub=ti(),Kn.encrypted=await oi(_n),t=JSON.stringify(Kn),e=await ei(t),Kn.meta.serverSig=e,Cn("userDataStore")};var fi,si,ci=function(){return{email:"",passwordSHSH:"",subscribedUntil:0,isTester:!1,latestInteraction:0}},li=function(){var t,e,r;for(t in e=[],_n)r=_n[t],e.push({userId:t,email:r.email,subscribedUntil:r.subscribedUntil,isTester:r.isTester,lastInteraction:r.lastInteraction});return e},hi=function(t){return Fn("getUserData"),_n[t]},yi=function(t){return Fn("addNewUser not implemented yet!"),"11111111111111111111111111111111"},di=async function(t,e){Fn("setUserData"),_n[t]=e;try{await Yn()}catch(t){Fn(t)}},pi=async function(t){Fn("removeUserData"),null!=_n[t]&&delete _n[t];try{await Yn()}catch(t){Fn(t)}};({log:fi,olog:si}=N("rpcapimodule")),I("echo",function(t){return t},{bodySizeLimit:1e5,argsSchema:ke,resultSchema:{echo:ke}}),I("ping",function(){return{message:"pong"}},{bodySizeLimit:0,resultSchema:{message:ke}}),I("areYouOkay",function(){}),I("login",cn,{bodySizeLimit:348,authOption:sn,argsSchema:{email:Pe,passwordSH:Fe},resultSchema:{authCode:Fe,validUntil:Ke}}),I("register",hn,{bodySizeLimit:267,argsSchema:{email:Pe}}),I("requestPasswordReset",ln,{bodySizeLimit:267,argsSchema:{email:Pe}}),I("getUserList",li,{bodySizeLimit:568,authOption:S,resultSchema:We}),I("getUser",hi,{bodySizeLimit:600,authOption:S,argsSchema:De,resultSchema:{userId:De,email:Pe,subscribedUntil:Ke,isTester:Ze,lastInteraction:Ke},responseAuth:m}),I("updateUser",function(t){var e;if(fi("updateUser"),null==(e=hi(t.userId)))return"User does not exist!";e.email=t.email,e.subscribedUntil=t.subscribedUntil,e.isTester=t.isTester,di(t.userId,e)},{bodySizeLimit:1024,authOption:S,argsSchema:{userId:De,email:Pe,subscribedUntil:Ke,isTester:Ze}}),I("createUser",async function(t){var e;return fi("createUser"),(e=ci()).email=t.email,e.subscribedUntil=t.subscribedUntil,e.isTester=t.isTester,e.passwordSHSH=await getPasswordHash(t.passwordSH),yi(e)},{bodySizeLimit:1220,authOption:S,argsSchema:{email:Pe,passwordSH:Fe,subscribedUntil:Ke,isTesterAccount:Ze},resultSchema:De,responseAuth:m}),I("deleteUser",function(t){fi("deleteUser"),pi(t)},{bodySizeLimit:500,authOption:S,argsSchema:De});require("node:http");var gi,vi,wi,Ni,Oi,Ei,xi,bi,Si,mi,Ai,Ri,Ii,Ti;require("node:fs"),require("node:crypto"),({log:wi,olog:Ni}=N("scimodule")),gi={error:br},Ti=Object.create(null),Ei=function(t){t.statusCode=400,t.setHeader("Content-Type","text/plain"),t.end('400 "Request Malformed!"\n'),null!=arguments[1]&&console.error(arguments[1])},xi=function(t){t.statusCode=401,t.setHeader("Content-Type","text/plain"),t.end('401 "Not Authorized!"\n'),null!=arguments[1]&&console.error(arguments[1])},bi=function(t){t.statusCode=404,t.setHeader("Content-Type","text/plain"),t.end('404 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},Si=function(t){t.statusCode=405,t.setHeader("Content-Type","text/plain"),t.end('405 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},mi=function(t){t.statusCode=413,t.setHeader("Content-Type","text/plain"),t.end('413 "Payload too large!"\n'),null!=arguments[1]&&console.error(arguments[1])},Ai=function(t){t.statusCode=500,t.setHeader("Content-Type","text/plain"),t.end('500 "Execution Error!"\n'),null!=arguments[1]&&console.error(arguments[1])},Ri=function(t,e){t.statusCode=422,t.setHeader("Content-Type","text/plain"),t.end(`422 ${e}\n`),null!=arguments[1]&&console.error(e)},Ii=function(t,e){t.setHeader("Content-Type","application/json"),"string"==typeof e&&e.length>0?(t.statusCode=200,t.end(e)):(t.statusCode=204,t.end())},Oi=async function(t,e,r,n){var i,o;wi("processRequest"),null!=n.bodyObj&&(o=n.bodyObj.auth,i=n.bodyObj.args),null!=o||null!=i?(n.auth=o,n.args=i):(n.auth=n.bodyObj,n.args=n.bodyObj);try{await r.handler(t,e,n)}catch(t){Ai(e,t)}};var Hi,Li,Gi=function(){wi("prepareAndExpose")};(vi=Object.create(null))["0000"]=function(t,e,r){return async function(r,n,i){var o;return""!==i.bodyString||void 0!==i.bodyObj||void 0!==i.auth||void 0!==i.args?Ei(n,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(i),"string"==typeof(o=await e(void 0,i))&&o.length>0?Ri(n,'"'+o+'"'):Ii(n,""))}},vi[1e3]=function(t,e,r){var n,i;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${t}!`);return i=async function(t,r,i){var o,a;return(o=await n(t,i))?xi(r,`Authentication fail! (${o})`):(Object.freeze(i.auth),i.args=void 0,Object.freeze(i),"string"==typeof(a=await e(void 0,i))&&a.length>0?Ri(r,'"'+a+'"'):Ii(r,""))},i},vi["0100"]=function(t,e,r){var n,i;if("function"!=typeof(i=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);return n=async function(t,r,n){var o,a;return(o=i(n.args))?Ei(r,`Validation fail! (${o})`):(Object.freeze(n),"string"==typeof(a=await e(n.args,n))&&a.length>0?Ri(r,'"'+a+'"'):Ii(r,""))},n},vi[1100]=function(t,e,r){var n,i,o;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(o=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);return i=async function(t,r,i){var a,u;return(a=await n(t,i))?xi(r,`Authentication fail! (${a})`):(Object.freeze(i.auth),(a=o(i.args))?Ei(r,`Validation fail! (${a})`):(Object.freeze(i),"string"==typeof(u=await e(i.args,i))&&u.length>0?Ri(r,'"'+u+'"'):Ii(r,"")))},i},vi["0010"]=function(t,e,r){var n,i;if("function"!=typeof(i=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(n=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);return async function(r,o,a){var u,f,s;return""!==a.bodyString||void 0!==a.bodyObj||void 0!==a.auth||void 0!==a.args?Ei(o,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(a),f=await e(void 0,a),i(f)?"string"==typeof f&&f.length>0?Ri(o,u='"'+f+'"'):Array.isArray(f)&&1===f.length&&"string"==typeof f[0]&&f[0].length>0?(u='"'+f[0]+'"',Ri(o,u)):checkForValidErrorObject(f)?Ai(o,"Invalid result!"):(u='{"error":'+JSON.stringify(f.error)+"}",Ri(o,u)):(s=n(f),Ii(o,s)))}},vi[1010]=function(t,e,r){var n,i,o,a,u;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(u=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(a=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);if("function"!=typeof(i=tn(gi)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);return o=async function(){var t,r,o,f;return(t=await n(req,ctx))?xi(res,`Authentication fail! (${t})`):(Object.freeze(ctx.auth),ctx.args=void 0,Object.freeze(ctx),o=await e(void 0,ctx),(t=u(o))?"string"==typeof o&&o.length>0?(r='"'+o+'"',Ri(res,r)):Array.isArray(o)&&1===o.length&&"string"==typeof o[0]&&o[0].length>0?(r='"'+o[0]+'"',Ri(res,r)):(t=i(o))?Ai(res,"Invalid result!"):(r='{"error":'+JSON.stringify(o.error)+"}",Ri(res,r)):(f=a(o),Ii(res,f)))},o},vi["0110"]=function(t,e,r){var n,i,o,a,u;if("function"!=typeof(a=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(u=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(o=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);if("function"!=typeof(n=tn(gi)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);return i=async function(){var t,r,i,f;return(t=a(ctx.args))?Ei(res,`Validation fail! (${t})`):(Object.freeze(ctx),i=await e(ctx.args,ctx),(t=u(i))?"string"==typeof i&&i.length>0?(r='"'+i+'"',Ri(res,r)):Array.isArray(i)&&1===i.length&&"string"==typeof i[0]&&i[0].length>0?(r='"'+i[0]+'"',Ri(res,r)):(t=n(i))?Ai(res,"Invalid result!"):(r='{"error":'+JSON.stringify(i.error)+"}",Ri(res,r)):(f=o(i),Ii(res,f)))},i},vi[1110]=function(t,e,r){var n,i,o,a,u,f;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(u=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(f=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(a=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);if("function"!=typeof(i=tn(gi)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);return o=async function(){var t,r,o,s;return(t=await n(req,ctx))?xi(res,`Authentication fail! (${t})`):(Object.freeze(ctx.auth),(t=u(ctx.args))?Ei(res,`Validation fail! (${t})`):(Object.freeze(ctx),o=await e(ctx.args,ctx),(t=f(o))?"string"==typeof o&&o.length>0?(r='"'+o+'"',Ri(res,r)):Array.isArray(o)&&1===o.length&&"string"==typeof o[0]&&o[0].length>0?(r='"'+o[0]+'"',Ri(res,r)):(t=i(o))?Ai(res,"Invalid result!"):(r='{"error":'+JSON.stringify(o.error)+"}",Ri(res,r)):(s=a(o),Ii(res,s))))},o},vi["0001"]=function(t,e,r){var n;if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return async function(){var r,i,o;return""!==ctx.bodyString||void 0!==ctx.bodyObj||void 0!==ctx.auth||void 0!==ctx.args?Ei(res,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(ctx),"string"==typeof(i=await e(void 0,ctx))&&i.length>0?(r='"'+i+'"',r=await n("error",r,ctx),Ri(res,r)):(o=await n("result","",ctx),Ii(res,o)))}},vi[1001]=function(t,e,r){var n,i,o;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${t}!`);if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(){var t,r,o,a;return(t=await i(req,ctx))?xi(res,`Authentication fail! (${t})`):(Object.freeze(ctx.auth),ctx.args=void 0,Object.freeze(ctx),"string"==typeof(o=await e(void 0,ctx))&&o.length>0?(r='"'+o+'"',r=await n("error",r,ctx),Ri(res,r)):(a=await n("result","",ctx),Ii(res,a)))},o},vi["0101"]=function(t,e,r){var n,i,o;if("function"!=typeof(o=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return i=async function(){var t,r,i,a;return(t=o(ctx.args))?Ei(res,`Validation fail! (${t})`):(Object.freeze(ctx),"string"==typeof(i=await e(ctx.args,ctx))&&i.length>0?(r='"'+i+'"',r=await n("error",r,ctx),Ri(res,r)):(a=await n("result","",ctx),Ii(res,a)))},i},vi[1101]=function(t,e,r){var n,i,o,a;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(a=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(){var t,r,o,u;return(t=await i(req,ctx))?xi(res,`Authentication fail! (${t})`):(Object.freeze(ctx.auth),(t=a(ctx.args))?Ei(res,`Validation fail! (${t})`):(Object.freeze(ctx),"string"==typeof(o=await e(ctx.args,ctx))&&o.length>0?(r='"'+o+'"',r=await n("error",r,ctx),Ri(res,r)):(u=await n("result","",ctx),Ii(res,u))))},o},vi["0011"]=function(t,e,r){var n,i,o,a;if("function"!=typeof(a=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(o=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);if("function"!=typeof(i=tn(gi)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return async function(){var r,u,f;return""!==ctx.bodyString||void 0!==ctx.bodyObj||void 0!==ctx.auth||void 0!==ctx.args?Ei(res,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(ctx),u=await e(void 0,ctx),a(u)?"string"==typeof u&&u.length>0?(r='"'+u+'"',r=await n("error",r,ctx),Ri(res,r)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(r='"'+u[0]+'"',r=await n("error",r,ctx),Ri(res,r)):i(u)?Ai(res,"Invalid result!"):(r='{"error":'+JSON.stringify(u.error)+"}",r=await n("error",r,ctx),Ri(res,r)):(f=o(u),f=await n("result",f,ctx),Ii(res,f)))}},vi[1011]=function(t,e,r){var n,i,o,a,u,f;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(f=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(u=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);if("function"!=typeof(o=tn(gi)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return a=async function(){var t,r,a,s;return(t=await i(req,ctx))?xi(res,`Authentication fail! (${t})`):(Object.freeze(ctx.auth),ctx.args=void 0,Object.freeze(ctx),a=await e(void 0,ctx),(t=f(a))?"string"==typeof a&&a.length>0?(r='"'+a+'"',r=await n("error",r,ctx),Ri(res,r)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(r='"'+a[0]+'"',r=await n("error",r,ctx),Ri(res,r)):(t=o(a))?Ai(res,"Invalid result!"):(r='{"error":'+JSON.stringify(a.error)+"}",r=await n("error",r,ctx),Ri(res,r)):(s=u(a),s=await n("result",s,ctx),Ii(res,s)))},a},vi["0111"]=function(t,e,r){var n,i,o,a,u,f;if("function"!=typeof(u=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(f=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(a=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);if("function"!=typeof(i=tn(gi)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(){var t,r,o,s;return(t=u(ctx.args))?Ei(res,`Validation fail! (${t})`):(Object.freeze(ctx),o=await e(ctx.args,ctx),(t=f(o))?"string"==typeof o&&o.length>0?(r='"'+o+'"',r=await n("error",r,ctx),Ri(res,r)):Array.isArray(o)&&1===o.length&&"string"==typeof o[0]&&o[0].length>0?(r='"'+o[0]+'"',r=await n("error",r,ctx),Ri(res,r)):(t=i(o))?Ai(res,"Invalid result!"):(r='{"error":'+JSON.stringify(o.error)+"}",r=await n("error",r,ctx),Ri(res,r)):(s=a(o),s=await n("result",s,ctx),Ii(res,s)))},o},vi[1111]=function(t,e,r){var n,i,o,a,u,f,s;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(f=tn(r.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(s=tn(r.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(u=Qr(r.resultSchema)))throw new Error(`stringifyResult is not a function @${t}!`);if("function"!=typeof(o=tn(gi)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if(n=r.responseAuth,"function"!=typeof responseAuth)throw new Error(`addResponseAuth is not a function @${t}!`);return a=async function(){var t,r,a,c;return(t=await i(req,ctx))?xi(res,`Authentication fail! (${t})`):(Object.freeze(ctx.auth),(t=f(ctx.args))?Ei(res,`Validation fail! (${t})`):(Object.freeze(ctx),a=await e(ctx.args,ctx),(t=s(a))?"string"==typeof a&&a.length>0?(r='"'+a+'"',r=await n("error",r,ctx),Ri(res,r)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(r='"'+a[0]+'"',r=await n("error",r,ctx),Ri(res,r)):(t=o(a))?Ai(res,"Invalid result!"):(r='{"error":'+JSON.stringify(a.error)+"}",r=await n("error",r,ctx),Ri(res,r)):(c=u(a),c=await n("result",c,ctx),Ii(res,c))))},a},({log:Hi,olog:Li}=N("startupmodule")),zn(Wt);var ji,$i,Ui=function(){Hi("serviceStartup"),Gi()};({log:ji,olog:$i}=N("subscriptionmodule"));var zi=function(){ji("initialize")};const Ci={adminauthmodule:e,sciregistrymodule:r,authutilmodule:n,configmodule:i,debugmodule:o,errormodule:a,rpcapimodule:l,schemamodule:u,scimodule:h,servicekeysmodule:s,startupmodule:y,subscriptionmodule:g,userauthmodule:f,userdatamodule:c};var Bi;global.allModules=Ci,Bi=async function(){var t,e,r;return r=function(){var r;for(e in r=[],Ci)null!=(t=Ci[e]).initialize&&r.push(t.initialize(i));return r}(),await Promise.all(r),Ci.startupmodule.serviceStartup()},Bi()})();