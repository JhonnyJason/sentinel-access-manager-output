/*! For license information please see service.js.LICENSE.txt */
(()=>{"use strict";var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{addServerSignature:()=>S,initialize:()=>b,signatureAuth:()=>m});var e={};t.r(e),t.d(e,{getPasswordHash:()=>Ft,initialize:()=>qt});var n={};t.r(n),t.d(n,{authCodeValidityMS:()=>Pt,persistentStateOptions:()=>Dt});var i={};t.r(i);var o={};t.r(o),t.d(o,{initialize:()=>lr,thrw:()=>cr});var a={};t.r(a),t.d(a,{getPasswordHash:()=>_r,initialize:()=>Ur,onLoginSuccess:()=>Br,passwordReset:()=>Rr,register:()=>kr,userLoginAuth:()=>Tr});var f={};t.r(f),t.d(f,{freeRegistry:()=>Vr,getRegistry:()=>Lr,sciAdd:()=>qr});var u={};t.r(u),t.d(u,{decrypt:()=>Be,encrypt:()=>Te,getEntropySeed:()=>Ue,getPublicKeyHex:()=>Ce,getSignedNodeId:()=>Ie,initialize:()=>$e,isNotGod:()=>ze,sign:()=>Je,verify:()=>He});var s={};t.r(s),t.d(s,{addNewUser:()=>Fe,getNewUserObject:()=>Le,getUserData:()=>qe,getUserList:()=>Ve,initialize:()=>Re,removeUserData:()=>De,setUserData:()=>Pe});var l={};t.r(l);var c={};t.r(c),t.d(c,{prepareAndExpose:()=>wn});var d={};t.r(d),t.d(d,{serviceStartup:()=>Sn});var h,y,g={};t.r(g),t.d(g,{initialize:()=>On}),y=function(t){return JSON.stringify(t,null,4)},h={};var p,v,w=function(t){var r,e;return e=function(t){return r("\n"+y(t))},{log:r=function(r){h[t]&&console.log("["+t+"]: "+r)},olog:e}};({log:p,olog:v}=w("adminauthmodule"));var b=function(){p("initialize")},m=function(t,r){p("signatureAuth"),v(r)},S=function(t,r){var e,n,i,o,a;p("addServerSignature"),p(t),v(r),o="ffffffff".repeat(16),e=',"auth":{"serverId":"'+"aaaaaaaa".repeat(8)+'","timestamp":'+Date.now()+',"signature":\\}}',t.length,i=t.slice(0,-1)+e,p(i),a='"signature":"'+o+'"',i=i.replace('"signature":\\',a);try{v(JSON.parse(i))}catch(t){n=t,console.error(n)}return i};const{p:O,n:A,Gx:E,Gy:x,a:N,d:j}={p:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedn,n:0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3edn,h:8n,a:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecn,d:0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3n,Gx:0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,Gy:0x6666666666666666666666666666666666666666666666666666666666666658n},$=32,z=(t="")=>{throw new Error(t)},C=t=>"string"==typeof t,J=(t,r)=>!(t=>t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name)(t)||"number"==typeof r&&r>0&&t.length!==r?z("Uint8Array expected"):t,H=t=>new Uint8Array(t),I=t=>Uint8Array.from(t),U=(t,r)=>t.toString(16).padStart(r,"0"),T=t=>Array.from(J(t)).map(t=>U(t,2)).join(""),B=t=>t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:void 0,R=t=>{const r="hex invalid";if(!C(t))return z(r);const e=t.length,n=e/2;if(e%2)return z(r);const i=H(n);for(let e=0,o=0;e<n;e++,o+=2){const n=B(t.charCodeAt(o)),a=B(t.charCodeAt(o+1));if(void 0===n||void 0===a)return z(r);i[e]=16*n+a}return i},k=(t,r)=>J(C(t)?R(t):I(J(t)),r),_=()=>globalThis?.crypto,L=(...t)=>{const r=H(t.reduce((t,r)=>t+J(r).length,0));let e=0;return t.forEach(t=>{r.set(t,e),e+=t.length}),r},V=(t=$)=>_().getRandomValues(H(t)),q=BigInt,F=(t,r,e,n="bad number: out of range")=>(t=>"bigint"==typeof t)(t)&&r<=t&&t<e?t:z(n),P=(t,r=O)=>{const e=t%r;return e>=0n?e:r+e},D=t=>P(t,A),K=(t,r)=>{(0n===t||r<=0n)&&z("no inverse n="+t+" mod="+r);let e=P(t,r),n=r,i=0n,o=1n,a=1n,f=0n;for(;0n!==e;){const t=n/e,r=n%e,u=i-a*t,s=o-f*t;n=e,e=r,i=a,o=f,a=u,f=s}return 1n===n?P(i,r):z("no inverse")},M=t=>t instanceof Z?t:z("Point expected"),G=2n**256n;class Z{static BASE;static ZERO;ex;ey;ez;et;constructor(t,r,e,n){const i=G;this.ex=F(t,0n,i),this.ey=F(r,0n,i),this.ez=F(e,1n,i),this.et=F(n,0n,i),Object.freeze(this)}static fromAffine(t){return new Z(t.x,t.y,1n,P(t.x*t.y))}static fromBytes(t,r=!1){const e=j,n=I(J(t,$)),i=t[31];n[31]=-129&i;const o=X(n);F(o,0n,r?G:O);const a=P(o*o),f=P(a-1n),u=P(e*a+1n);let{isValid:s,value:l}=et(f,u);s||z("bad point: y not sqrt");const c=1n==(1n&l),d=!!(128&i);return!r&&0n===l&&d&&z("bad point: x==0, isLastByteOdd"),d!==c&&(l=P(-l)),new Z(l,o,1n,P(l*o))}assertValidity(){const t=N,r=j;if(this.is0())throw new Error("bad point: ZERO");const{ex:e,ey:n,ez:i,et:o}=this,a=P(e*e),f=P(n*n),u=P(i*i),s=P(u*u),l=P(a*t);if(P(u*P(l+f))!==P(s+P(r*P(a*f))))throw new Error("bad point: equation left != right (1)");if(P(e*n)!==P(i*o))throw new Error("bad point: equation left != right (2)");return this}equals(t){const{ex:r,ey:e,ez:n}=this,{ex:i,ey:o,ez:a}=M(t),f=P(r*a),u=P(i*n),s=P(e*a),l=P(o*n);return f===u&&s===l}is0(){return this.equals(Q)}negate(){return new Z(P(-this.ex),this.ey,this.ez,P(-this.et))}double(){const{ex:t,ey:r,ez:e}=this,n=N,i=P(t*t),o=P(r*r),a=P(2n*P(e*e)),f=P(n*i),u=t+r,s=P(P(u*u)-i-o),l=f+o,c=l-a,d=f-o,h=P(s*c),y=P(l*d),g=P(s*d),p=P(c*l);return new Z(h,y,p,g)}add(t){const{ex:r,ey:e,ez:n,et:i}=this,{ex:o,ey:a,ez:f,et:u}=M(t),s=N,l=j,c=P(r*o),d=P(e*a),h=P(i*l*u),y=P(n*f),g=P((r+e)*(o+a)-c-d),p=P(y-h),v=P(y+h),w=P(d-s*c),b=P(g*p),m=P(v*w),S=P(g*w),O=P(p*v);return new Z(b,m,O,S)}multiply(t,r=!0){if(!r&&(0n===t||this.is0()))return Q;if(F(t,1n,A),1n===t)return this;if(this.equals(Y))return gt(t).p;let e=Q,n=Y;for(let i=this;t>0n;i=i.double(),t>>=1n)1n&t?e=e.add(i):r&&(n=n.add(i));return e}toAffine(){const{ex:t,ey:r,ez:e}=this;if(this.equals(Q))return{x:0n,y:1n};const n=K(e,O);return 1n!==P(e*n)&&z("invalid inverse"),{x:P(t*n),y:P(r*n)}}toBytes(){const{x:t,y:r}=this.assertValidity().toAffine(),e=W(r);return e[31]|=1n&t?128:0,e}toHex(){return T(this.toBytes())}clearCofactor(){return this.multiply(q(8n),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let t=this.multiply(A/2n,!1).double();return A%2n&&(t=t.add(this)),t.is0()}static fromHex(t,r){return Z.fromBytes(k(t),r)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}toRawBytes(){return this.toBytes()}}const Y=new Z(E,x,1n,P(E*x)),Q=new Z(0n,1n,1n,0n);Z.BASE=Y,Z.ZERO=Q;const W=t=>R(U(F(t,0n,G),64)).reverse(),X=t=>q("0x"+T(I(J(t)).reverse())),tt=(t,r)=>{let e=t;for(;r-- >0n;)e*=e,e%=O;return e},rt=0x2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0n,et=(t,r)=>{const e=P(r*r*r),n=(t=>{const r=t*t%O*t%O,e=tt(r,2n)*r%O,n=tt(e,1n)*t%O,i=tt(n,5n)*n%O,o=tt(i,10n)*i%O,a=tt(o,20n)*o%O,f=tt(a,40n)*a%O,u=tt(f,80n)*f%O,s=tt(u,80n)*f%O,l=tt(s,10n)*i%O;return{pow_p_5_8:tt(l,2n)*t%O,b2:r}})(t*P(e*e*r)).pow_p_5_8;let i=P(t*e*n);const o=P(r*i*i),a=i,f=P(i*rt),u=o===t,s=o===P(-t),l=o===P(-t*rt);return u&&(i=a),(s||l)&&(i=f),1n==(1n&P(i))&&(i=P(-i)),{isValid:u||s,value:i}},nt=t=>D(X(t)),it=(...t)=>lt.sha512Async(...t),ot=t=>{const r=t.slice(0,$);r[0]&=248,r[31]&=127,r[31]|=64;const e=t.slice($,64),n=nt(r),i=Y.multiply(n),o=i.toBytes();return{head:r,prefix:e,scalar:n,point:i,pointBytes:o}},at=t=>it(k(t,$)).then(ot),ft=t=>at(t).then(t=>t.pointBytes),ut=t=>it(t.hashable).then(t.finish),st={zip215:!0},lt={sha512Async:async(...t)=>{const r=_()?.subtle??z("crypto.subtle must be defined"),e=L(...t);return H(await r.digest("SHA-512",e.buffer))},sha512Sync:void 0,bytesToHex:T,hexToBytes:R,concatBytes:L,mod:P,invert:K,randomBytes:V},ct=()=>V($),dt=Math.ceil(32)+1;let ht;const yt=(t,r)=>{const e=r.negate();return t?e:r},gt=t=>{const r=ht||(ht=(()=>{const t=[];let r=Y,e=r;for(let n=0;n<dt;n++){e=r,t.push(e);for(let n=1;n<128;n++)e=e.add(r),t.push(e);r=e.double()}return t})());let e=Q,n=Y;const i=q(255),o=q(8);for(let a=0;a<dt;a++){let f=Number(t&i);t>>=o,f>128&&(f-=256,t+=1n);const u=128*a,s=u,l=u+Math.abs(f)-1,c=a%2!=0,d=f<0;0===f?n=n.add(yt(c,r[s])):e=e.add(yt(d,r[l]))}return{p:e,f:n}},pt=require("string_decoder");var vt,wt,bt,mt;wt=new pt.StringDecoder("utf-8"),new Array(256).fill(0).map(function(t,r){return BigInt(r)}),mt=Array.from("0123456789abcdef"),bt=new Array(256),mt.forEach(function(t){return bt[t]=16*parseInt(t,16)}),vt=new Array(256),mt.forEach(function(t){return vt[t]=parseInt(t,16)});var St=function(t){return new Uint8Array(Buffer.from(t,"utf8"))},Ot=function(t){return Buffer.from(t).toString("hex")},At=function(t){var r,e,n,i;for(i=new Uint8Array(t.length/2),r=e=0,n=t.length;e<n;r=e+=2)i[r/2]=bt[t[r]]+vt[t[r+1]];return i};const Et=require("crypto");var xt,Nt,jt,$t;Nt="aes-256-cbc",xt=BigInt(2)**BigInt(252)+BigInt("27742317777372353535851937790883648493"),jt=function(t){var r,e,n,i;return(e=t.slice(0,32))[0]&=248,e[31]&=127,e[31]|=64,n=new Uint8Array(e),i=Ot(n.reverse()),r=BigInt("0x"+i),$t(r)},$t=function(t,r=xt){var e;return(e=t%r)>=0n?e:e+r};var zt,Ct,Jt=function(t){var r;return(r=Et.createHash("sha512")).update(t),r.digest("hex")},Ht=function(t){var r;return(r=Et.createHash("sha512")).update(t),r.digest()},It=async function(t,r){var e,n,i;return e=St(t),i=At(r),n=await(async(t,r)=>{const e=k(t),n=await at(r),i=await it(n.prefix,e);return ut(((t,r,e)=>{const{pointBytes:n,scalar:i}=t,o=nt(r),a=Y.multiply(o).toBytes();return{hashable:L(a,n,e),finish:t=>{const r=D(o+nt(t)*i);return J(L(a,W(r)),64)}}})(n,i,e))})(e,i),Ot(n)},Ut=async function(t,r,e){var n,i,o;return o=At(t),i=At(r),n=St(e),await(async(t,r,e,n=st)=>ut(((t,r,e,n=st)=>{t=k(t,64),r=k(r),e=k(e,$);const{zip215:i}=n;let o,a,f,u,s=Uint8Array.of();try{o=Z.fromHex(e,i),a=Z.fromHex(t.slice(0,$),i),f=X(t.slice($,64)),u=Y.multiply(f,!1),s=L(a.toBytes(),o.toBytes(),r)}catch(t){}return{hashable:s,finish:t=>{if(null==u)return!1;if(!i&&o.isSmallOrder())return!1;const r=nt(t);return a.add(o.multiply(r,!1)).add(u.negate()).clearCofactor().is0()}}})(t,r,e,n)))(o,n,i)},Tt=async function(t,r){var e,n,i,o,a,f;return n=Z.fromHex(r),f=ct(),a=jt(Ht(f)),e=await ft(f),o=n.multiply(a),i=function(t,r){var e,n,i,o,a,f;return a=r.substring(0,32),o=Buffer.from(a,"hex"),n=r.substring(32,96),e=Buffer.from(n,"hex"),f=kt(t),(i=Et.createCipheriv(Nt,e,o)).update(f,null,"hex")+i.final("hex")}(t,Jt(o.toRawBytes())),{referencePointHex:Ot(e),encryptedContentHex:i}},Bt=function(t,r){var e,n,i,o,a;if(e=t.referencePointHex||t.referencePoint,i=t.encryptedContentHex||t.encryptedContent,null==e||null==i)throw new Error("Invalid secrets Object!");return n=At(r),a=jt(Ht(n)),o=Z.fromHex(e).multiply(a),function(t,r){var e,n,i,o,a,f,u,s,l,c,d,h,y,g;if(l=r.substring(0,32),s=Buffer.from(l,"hex"),n=r.substring(32,96),e=Buffer.from(n,"hex"),g=(a=Et.createDecipheriv(Nt,e,s)).update(t,"hex"),0===(f=a.final()).length)return _t(g);for(i=new Uint8Array(g.length+f.length),u=c=0,h=kt.length;c<h;u=++c)o=kt[u],i[u]=o;for(u=d=0,y=f.length;d<y;u=++d)o=f[u],i[g.length+u]=o;return _t(i)}(i,Jt(o.toRawBytes()))},Rt=function(t,r,e=""){var n,i,o,a,f,u,s,l,c,d,h;for(n=At(t),l=jt(Ht(n)),s=Z.fromHex(r).multiply(l).toRawBytes(),o=St(e),h=new Uint8Array(s.length+o.length),a=f=0,c=s.length;f<c;a=++f)i=s[a],h[a]=i;for(a=u=0,d=o.length;u<d;a=++u)i=o[a],h[s.length+a]=i;return Jt(h)},kt=function(t){var r,e,n,i,o,a,f,u,s,l,c,d,h,y;for(e=(t=St(t)).length,d=33+(127&Et.randomBytes(1)[0]),c=Et.randomBytes(d),i=(y=(s=d+3)+e)+(u=32-y%32),l=new Uint8Array(i),o=a=0,f=t.length;a<f;o=++a)r=t[o],l[o+s]=r;for(h=0,o=32;o--;)h+=c[o],l[o]=c[o];for(l[d+2]=u,o=0,n=i-1;o<u;)l[n-o]=c[o],o++;for(o=32;o<d;)c[o+1]+=h===256*c[o]+c[o+1],h+=c[o],l[o]=c[o],o++;return l[d]=h>>8,l[d+1]=h%256,l[d]===l[d-1]&&l[d+1]===2*l[d]&&(l[d-1]++,h++,l[d]=h>>8,l[d+1]=h%256),l},_t=function(t){var r,e,n,i,o,a,f,u,s,l;for(a=(o=(e=t.length)>160?160:e)+1,s=0,n=32;n--;)s+=t[n];for(n=32;n<a;){if(s===256*t[n]+t[n+1]){u=n+3,f=t[n+2];break}s+=t[n],n++}if(n>o)throw new Error("Unsalt: No valid prefix ending found!");for(n=0,r=e-1,i=0;n<f;)i+=t[n]!==t[r-n],n++;if(i)throw new Error("Unsalt: Postfix and prefix did not match as expected!");return r=e-f,t=t.slice(u,r),l=new Uint8Array(t),wt.end(l)};({log:zt,olog:Ct}=w("authutilmodule"));var Lt,Vt,qt=function(){zt("initialize")},Ft=async function(t){return zt("getPasswordHash"),await(r=t,(e=Et.createHash("sha256")).update(r),e.digest("hex"));var r,e},Pt=72e5,Dt={basePath:"../state",maxCacheSize:128};(function(t){var r;for(r in t)t[r]&&(h[r]=!0)})({adminauthmodule:!0,userauthmodule:!0,rpcapimodule:!0,scimodule:!0,userdatamodule:!0}),({log:Lt,olog:Vt}=w("errormodule"));var Kt,Mt,Gt,Zt,Yt,Qt,Wt,Xt,tr,rr,er,nr,ir,or,ar,fr,ur,sr,lr=function(){Lt("initialize")},cr=function(t){throw new Error(t)};for(ur=null,fr=/^\d+$/,or=/(\.\.|--|-\.)|\.-/,nr=new Array(103),ir=0;ir<22;)nr["0123456789abcdefABCDEF".charCodeAt(ir)]=!0,ir++;for(Xt=new Array(123),ir=0;ir<64;)Xt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.".charCodeAt(ir)]=!0,ir++;for(Wt="\0\b\v\f\rÂÂ‚ÂƒÂ„Â†Â‡ÂˆÂ‰ÂŠÂ‹ÂŒÂÂŽÂÂÂ‘Â’Â“Â”Â•Â–Â—Â˜Â™ÂšÂ›ÂœÂÂžÂŸ",Qt=new Array(160),ir=0;ir<61;)Qt[Wt.charCodeAt(ir)]=!0,ir++;ar=function(t){var r,e,n,i;if(null!==t){for(r=0,i=(n=Object.keys(t)).length;r<i;r++){if("__proto__"===(e=n[r])||"constructor"===e||"prototype"===e)return!0;if("object"==typeof t[e]&&ar(t[e]))return!0}return!1}},Zt=function(t){return function(r){if(r!==t)return jr}},Yt=function(t){return function(){throw new Error(t)}},tr=function(t){var r;if(null==(r=sr[t]))throw new Error(`Unrecognized Schematype! (${t})`);return r},rr=function(t){var r,e,n,i;for(e=new Array(t.length),ir=n=0,i=t.length;n<i;ir=++n)switch(r=t[ir],!1){case"number"!=typeof r:e[ir]=tr(r);break;case"string"!=typeof r:e[ir]=ur(r);break;case"object"==typeof r:throw new Error(`Illegal ${typeof r}!`);case!Array.isArray(r):e[ir]=Mt(r);break;default:e[ir]=Gt(r)}return e},er=function(t){var r,e,n,i,o,a;for(i=Object.keys(t),r=[],ir=e=0,o=i.length;e<o;ir=++e)if("number"!=typeof(a=t[n=i[ir]]))if("string"!=typeof a){if("object"!=typeof a)throw new Error(`Illegal ${typeof a}!`);Array.isArray(a)?r.push([n,Mt(a)]):r.push([n,Gt(a)])}else r.push([n,ur(a)]);else r.push([n,tr(a)]);return r},Mt=function(t){var r,e;if(0===t.length)throw new Error("[] is illegal!");return e=rr(t),r=function(t){var r,n,i,o,a,f;if(!Array.isArray(t))return jr;for(o=0,ir=a=0,f=e.length;a<f;ir=++a)if(i=e[ir],void 0!==(r=t[ir])&&o++,n=i(r))return n;return t.length>o?jr:void 0},r},Gt=function(t){var r,e;if(null===t)throw new Error("null is illegal!");if(0===(e=er(t)).length)throw new Error("{} is illegal!");return r=function(t){var r,n,i,o,a,f;if("object"!=typeof t)return jr;if(null===t)return jr;for(i=0,o=0,a=e.length;o<a;o++)if(void 0!==(f=t[(r=e[o])[0]])&&i++,n=r[1](f))return n;return Object.keys(t).length>i?jr:void 0},r},(sr=new Array(47))[5]=function(t){if("string"!=typeof t)return dr},sr[6]=function(t){var r,e,n,i,o,a,f;if("string"!=typeof t)return dr;if(t.length>320||t.length<5)return br;if(or.test(t))return wr;if((r=t.indexOf("@"))<=0||r>64||t.length-r<4||"."===t[0]||"."===t[r-1]||"-"===t[0]||"-"===t[r-1]||"."===t[r+1]||"-"===t[r+1])return wr;for(ir=i=0,a=t.length;i<a;ir=++i)if(e=t[ir],!(Xt[t.charCodeAt(ir)]||ir===r||ir<r&&("+"===e||"_"===e)))return wr;if("."===t[t.length-1]||"-"===t[t.length-1])return wr;if(o=r,(n=t.indexOf(".",r+1))<0)return wr;for(;n>0;){if(n-o>63)return wr;o=n,n=t.indexOf(".",o+1)}return f=t.slice(o+1),fr.test(f)?wr:void 0},sr[7]=function(t){if("string"!=typeof t)return dr;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}},sr[8]=function(t){if("string"!=typeof t)return dr;if(32!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}},sr[9]=function(t){if("string"!=typeof t)return dr;if(64!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}},sr[10]=function(t){if("string"!=typeof t)return dr;if(128!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}},sr[11]=function(t){if("string"!=typeof t)return dr;if(256!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}},sr[12]=function(t){if("string"!=typeof t)return dr;if(512!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}},sr[2]=function(t){return"number"!=typeof t?hr:isNaN(t)?mr:Infinity===t||-Infinity===t?Nr:void 0},sr[1]=function(t){if("boolean"!=typeof t)return yr},sr[3]=function(t){if(!Array.isArray(t))return gr},sr[4]=function(t){if("object"!=typeof t)return pr},sr[21]=function(t){if(void 0!==t)return"string"!=typeof t?dr:void 0},sr[22]=function(t){var r,e,n,i,o,a,f;if(void 0!==t){if("string"!=typeof t)return dr;if(t.length>320||t.length<5)return br;if(or.test(t))return wr;if((r=t.indexOf("@"))<=0||r>64||t.length-r<4||"."===t[0]||"."===t[r-1]||"-"===t[0]||"-"===t[r-1]||"."===t[r+1]||"-"===t[r+1])return wr;for(ir=i=0,a=t.length;i<a;ir=++i)if(e=t[ir],!(Xt[t.charCodeAt(ir)]||ir===r||ir<r&&("+"===e||"_"===e)))return wr;if("."===t[t.length-1]||"-"===t[t.length-1])return wr;if(o=r,(n=t.indexOf(".",r+1))<0)return wr;for(;n>0;){if(n-o>63)return wr;o=n,n=t.indexOf(".",o+1)}return f=t.slice(o+1),fr.test(f)?wr:void 0}},sr[23]=function(t){if(void 0!==t){if("string"!=typeof t)return dr;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[24]=function(t){if(void 0!==t){if("string"!=typeof t)return dr;if(32!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[25]=function(t){if(void 0!==t){if("string"!=typeof t)return dr;if(64!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[26]=function(t){if(void 0!==t){if("string"!=typeof t)return dr;if(128!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[27]=function(t){if(void 0!==t){if("string"!=typeof t)return dr;if(256!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[28]=function(t){if(void 0!==t){if("string"!=typeof t)return dr;if(512!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[30]=function(t){if(void 0!==t)return"number"!=typeof t?hr:isNaN(t)?mr:Infinity===t||-Infinity===t?Nr:void 0},sr[31]=function(t){if(void 0!==t)return"boolean"!=typeof t?yr:void 0},sr[32]=function(t){if(void 0!==t)return Array.isArray(t)?void 0:gr},sr[33]=function(t){if(void 0!==t)return"object"!=typeof t?pr:void 0},sr[35]=function(t){if(null!==t)return"string"!=typeof t?dr:void 0},sr[36]=function(t){var r,e,n,i,o,a,f;if(null!==t){if("string"!=typeof t)return dr;if(t.length>320||t.length<5)return br;if(or.test(t))return wr;if((r=t.indexOf("@"))<=0||r>64||t.length-r<4||"."===t[0]||"."===t[r-1]||"-"===t[0]||"-"===t[r-1]||"."===t[r+1]||"-"===t[r+1])return wr;for(ir=i=0,a=t.length;i<a;ir=++i)if(e=t[ir],!(Xt[t.charCodeAt(ir)]||ir===r||ir<r&&("+"===e||"_"===e)))return wr;if("."===t[t.length-1]||"-"===t[t.length-1])return wr;if(o=r,(n=t.indexOf(".",r+1))<0)return wr;for(;n>0;){if(n-o>63)return wr;o=n,n=t.indexOf(".",o+1)}return f=t.slice(o+1),fr.test(f)?wr:void 0}},sr[37]=function(t){if(null!==t){if("string"!=typeof t)return dr;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[38]=function(t){if(null!==t){if("string"!=typeof t)return dr;if(32!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[39]=function(t){if(null!==t){if("string"!=typeof t)return dr;if(64!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[40]=function(t){if(null!==t){if("string"!=typeof t)return dr;if(128!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[41]=function(t){if(null!==t){if("string"!=typeof t)return dr;if(256!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[42]=function(t){if(null!==t){if("string"!=typeof t)return dr;if(512!==t.length)return br;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}}},sr[44]=function(t){if(null!==t)return"number"!=typeof t?hr:isNaN(t)?mr:Infinity===t||-Infinity===t?Nr:void 0},sr[45]=function(t){if(null!==t)return"boolean"!=typeof t?yr:void 0},sr[46]=function(t){if(null!==t)return Array.isArray(t)?void 0:gr},sr[19]=function(t){return"object"!=typeof t?pr:null===t?Sr:void 0},sr[14]=function(t){return"string"!=typeof t?dr:0===t.length?Or:void 0},sr[17]=function(t){return Array.isArray(t)?0===t.length?Ar:void 0:gr},sr[15]=function(t){if("string"!=typeof t)return dr;if(0===t.length)return Or;for(ir=0;ir<t.length;){if(void 0===nr[t.charCodeAt(ir)])return vr;ir++}},sr[16]=function(t){var r;if("string"!=typeof t)return dr;if(0===t.length)return Or;for(ir=0;ir<t.length;){if((r=t.charCodeAt(ir))>767||Qt[r])return Er;ir++}},sr[13]=function(t){var r;if("string"!=typeof t)return dr;for(ir=0;ir<t.length;){if((r=t.charCodeAt(ir))>767||Qt[r])return Er;ir++}},sr[43]=function(t){var r;if(null!==t){if("string"!=typeof t)return dr;for(ir=0;ir<t.length;){if((r=t.charCodeAt(ir))>767||Qt[r])return Er;ir++}}},sr[29]=function(t){var r;if(void 0!==t){if("string"!=typeof t)return dr;for(ir=0;ir<t.length;){if((r=t.charCodeAt(ir))>767||Qt[r])return Er;ir++}}},sr[18]=function(t){return"object"!=typeof t?pr:ar(t)?xr:void 0},sr[20]=function(t){return"object"!=typeof t?pr:null===t?Sr:ar(t)?xr:void 0},sr[34]=function(t){if(void 0!==t)return"object"!=typeof t?pr:ar(t)?xr:void 0};var dr=1e3,hr=1001,yr=1002,gr=1003,pr=1004,vr=1005,wr=1006,br=1007,mr=1008,Sr=1009,Or=1010,Ar=1011,Er=1012,xr=1013,Nr=1014,jr=2222;(Kt=Object.create(null))[dr]="Not a String!",Kt[hr]="Not a Number!",Kt[yr]="Not a Boolean!",Kt[gr]="Not an Array!",Kt[pr]="Not an Object!",Kt[vr]="String is not valid hex!",Kt[wr]="String is not a valid email!",Kt[br]="String size mismatch!",Kt[mr]="Number is NaN!",Kt[Sr]="Object is null!",Kt[Or]="String is empty!",Kt[Ar]="Array is empty!",Kt[Er]="String is dirty!",Kt[xr]="Object is dirty!",Kt[Nr]="Number is not finite!",Kt[jr]="Is invalid!";var $r,zr,Cr=function(t,r){var e;if(ur=!0===r?Zt:Yt("Static string!"),"number"==(e=typeof t))return tr(t);if("string"===e)return ur(t);if("object"!==e)throw new Error(`Illegal ${typeof t}!`);return Array.isArray(t)?Mt(t):Gt(t)};({log:$r,olog:zr}=w("userauthmodule"));var Jr,Hr,Ir,Ur=function(){$r("initialize")},Tr=function(t,r){$r("userLoginAuth"),zr(r)},Br=function(t){return $r("onLoginSuccess"),zr(t),{authCode:"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",validUntil:Date.now()}},Rr=function(t){$r("passwordReset"),zr(t)},kr=function(t){$r("register"),zr(t)},_r=function(t){return"afafafafaffaffafafafafafaffaffafafafafafaffaffafafafafafaffaffaf"};({log:Jr,olog:Hr}=w("sciregistrymodule")),Ir=Object.create(null);var Lr=function(){return Object.freeze(Ir)},Vr=function(){return Ir=null},qr=function(t,r,e){if("string"!=typeof t)throw new Error("Route not a string!");if("function"!=typeof r)throw new Error("Func not a function!");if(null!=Ir[t])throw new Error("Cannot add route twice!");if(null==r)throw new Error("function must be defined!");null!=e&&"object"==typeof e||(e={}),Ir[t]={func:r,conf:e}};const Fr=require("path"),Pr=require("fs");var Dr,Kr,Mr,Gr,Zr,Yr;Mr=Pr.promises,Kr=null;var Qr,Wr,Xr,te,re,ee,ne,ie,oe,ae,fe,ue,se,le,ce=function(t){var r;null==t&&(t="./state"),r=Fr.isAbsolute(t)?t:Fr.resolve(process.cwd(),t),Kr=r,Pr.existsSync(Kr)||Pr.mkdirSync(Kr)};Zr=function(t){var r;return r=t+".json",Fr.resolve(Kr,r)},Gr=function(t){return t+".backup"},Dr=function(t){var r,e;r=Gr(t);try{Pr.copyFileSync(t,r)}catch(r){throw e="Error: backing up state failed!\n",e+="file: "+t+"\n",e+="reason: "+r.message,new Error(e)}},Yr=function(t){var r,e,n,i;i=Zr(t),r=Gr(i);try{return e=Pr.readFileSync(r,"utf-8"),n=JSON.parse(e),Mr.writeFile(i,e),{contentObj:n,contentJson:e}}catch(t){return{contentObj:n=null,contentJson:e=null}}},se=function(t){return JSON.stringify(t,null,4)},ie={},ue={},Wr=null,te=null,ne={},Xr=0,fe=64,ee=null;var de=function(t){t?(ee=t.defaultState,null!=t.maxCacheSize&&(fe=t.maxCacheSize),ce(t.basePath)):ce()};Qr=class{constructor(t){this.id=t,this.nextEntry=null,this.previousEntry=Wr,null==te&&(te=this),null!=Wr&&(Wr.nextEntry=this),Wr=this,ne[this.id]=this,++Xr>fe&&re()}touch(){null!=this.nextEntry&&(null!=this.previousEntry?(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry):(te=this.nextEntry,this.nextEntry.previousEntry=null),this.nextEntry=null,this.previousEntry=Wr,null!=Wr&&(Wr.nextEntry=this),Wr=this)}remove(){return null!=this.nextEntry&&null!=this.previousEntry&&(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry),null==this.nextEntry&&null==this.previousEntry&&(Wr=null,te=null),null!=this.nextEntry&&null==this.previousEntry&&(this.nextEntry.previousEntry=null,te=this.nextEntry),null==this.nextEntry&&null!=this.previousEntry&&(this.previousEntry.nextEntry=null,Wr=this.previousEntry),le(this.id)}toString(){var t;return t=this.id+"\n",null!=this.nextEntry?t+="  next: "+this.nextEntry.id+"\n":t+="  next: null\n",null!=this.previousEntry?t+="  previous: "+this.previousEntry.id+"\n":t+="  previous: null\n",t}},oe=function(t){var r,e;new Qr(t),({contentObj:e,contentJson:r}=function(t){var r,e;e=Zr(t);try{return r=Pr.readFileSync(e,"utf-8"),{contentObj:JSON.parse(r),contentJson:r}}catch(r){return Yr(t)}}(t)),null!=e?(ie[t]=r,ue[t]=e):ae(t)},ae=function(t){null==ee||null==ee[t]?(ie[t]="{}",ue[t]={}):(ie[t]=se(ee[t]),ue[t]=JSON.parse(ie[t]))},le=function(t){delete ue[t],delete ie[t],delete ne[t],Xr--},re=function(){var t;null!=(t=te)&&(null!=(te=t.nextEntry)&&(te.previousEntry=null),le(t.id))};var he=async function(t,r){var e;null!=ne[t]?ne[t].touch():new Qr(t),r&&(ue[t]=r),(e=se(ue[t]))!==ie[t]&&(ie[t]=e,await function(t,r){var e;e=Zr(t),Pr.writeFileSync(e,r),Dr(e)}(t,e))},ye=function(t){return null==ue[t]?oe(t):ne[t].touch(),ue[t]};var ge,pe,ve,we,be,me,Se=class{constructor(t){this.key=t.secretKeyHex,this.id=t.publicKeyHex,this.ctx=t.context,null==this.ctx&&(this.ctx="standard ThingyCryptoNode")}async sign(t){return await It(t,this.key)}async verify(t,r){return await Ut(t,this.id,r)}async encrypt(t){return await Tt(t,this.id)}async decrypt(t){return await Bt(t,this.key)}async diffieHellmanFor(t,r,e){var n;return n=`${r}:${this.ctx}_${e}`,await Rt(this.key,t,n)}};({log:pe,olog:ve}=w("servicekeysmodule")),de(),be=null,ge=null,me=null,we=new Promise(function(t){return me=t});var Oe,Ae,Ee,xe,Ne,je,$e=async function(){var t,r;pe("initialize"),(be=ye("serviceState")).secretKeyHex||(t=await async function(){var t,r;return r=ct(),t=await ft(r),{secretKeyHex:Ot(r),publicKeyHex:Ot(t)}}(),be.secretKeyHex=t.secretKeyHex,be.publicKeyHex=t.publicKeyHex,he("serviceState")),r={secretKeyHex:be.secretKeyHex,publicKeyHex:be.publicKeyHex,context:"thingy-rpc-post-connection"},ge=new Se(r),me(!0)},ze=function(t){return null!==t},Ce=function(){return ge.id},Je=async function(t){return await we,await ge.sign(t)},He=async function(t,r){return await we,await ge.verify(t,r)},Ie=async function(){var t,r,e;return pe("getSignedNodeId"),await we,pe("we are ready!"),(r={}).serverNodeId=be.publicKeyHex,r.timestamp=(e=Date.now())-e%18e4,t=JSON.stringify(r),r.signature=await Je(t),r},Ue=async function(t,r,e){return await we,await ge.diffieHellmanFor(t,r,e)},Te=async function(t){return await we,await ge.encrypt(JSON.stringify(t))},Be=async function(t){return await we,JSON.parse(await ge.decrypt(t))};({log:Oe,olog:Ae}=w("userdatamodule")),Ne={},xe={};var Re=async function(){var t;if(Oe("initialize"),null!=(Ne=ye("userDataStore")).meta)try{await je()}catch(r){t=r,console.error(`Corrupted userDataStore!\n${t.message}`),process.exit(78)}else Ne.meta={};if(null!=Ne.encrypted)try{xe=await Be(Ne.encrypted)}catch(r){Oe(t=r)}Ae(xe)};je=async function(){var t,r,e;if(Oe("validateUserDataStore"),!(r=(t=Ne.meta).serverSig))throw new Error("No signature in userDataStore.meta !");if(t.serverSig="",e=JSON.stringify(Ne),t.serverSig=r,!await He(r,e))throw new Error("Invalid Signature in authCodestore.meta !")},Ee=async function(){var t,r;Oe("signAndSaveUserDataStore"),Ne.meta.serverSig="",Ne.meta.serverPub=Ce(),Ne.encrypted=await Te(xe),t=JSON.stringify(Ne),r=await Je(t),Ne.meta.serverSig=r,he("userDataStore")};var ke,_e,Le=function(){return{email:"",passwordSHSH:"",subscribedUntil:0,isTester:!1,latestInteraction:0}},Ve=function(){var t,r,e;for(t in r=[],xe)e=xe[t],r.push({userId:t,email:e.email,subscribedUntil:e.subscribedUntil,isTester:e.isTester,lastInteraction:e.lastInteraction});return r},qe=function(t){return Oe("getUserData"),xe[t]},Fe=function(t){return Oe("addNewUser not implemented yet!"),"11111111111111111111111111111111"},Pe=async function(t,r){Oe("setUserData"),xe[t]=r;try{await Ee()}catch(t){Oe(t)}},De=async function(t){Oe("removeUserData"),null!=xe[t]&&delete xe[t];try{await Ee()}catch(t){Oe(t)}};({log:ke,olog:_e}=w("rpcapimodule")),qr("echo",function(t){return t},{bodySizeLimit:1e5,argsSchema:5,resultSchema:5}),qr("ping",function(){return"pong"},{bodySizeLimit:0,resultSchema:13}),qr("areYouOkay",function(){}),qr("login",Br,{bodySizeLimit:348,authOption:Tr,argsSchema:{email:6,passwordSH:9},resultSchema:{authCode:9,validUntil:2}}),qr("register",kr,{bodySizeLimit:267,argsSchema:{email:6}}),qr("requestPasswordReset",Rr,{bodySizeLimit:267,argsSchema:{email:6}}),qr("getUserList",Ve,{bodySizeLimit:568,authOption:m,resultSchema:3}),qr("getUser",function(t){var r;return ke("getUserData"),r=qe(t),_e({user:r}),null==r?"User does not exist!":{userId:t,email:r.email,subscribedUntil:r.subscribedUntil||null,isTester:r.isTester||!1,lastInteraction:r.lastInteraction||null}},{bodySizeLimit:600,authOption:m,argsSchema:7,resultSchema:{userId:7,email:6,subscribedUntil:44,isTester:1,lastInteraction:44},responseAuth:S}),qr("updateUser",function(t){var r;if(ke("updateUser"),null==(r=qe(t.userId)))return"User does not exist!";r.email=t.email,r.subscribedUntil=t.subscribedUntil,r.isTester=t.isTester,Pe(t.userId,r)},{bodySizeLimit:1024,authOption:m,argsSchema:{userId:8,email:22,subscribedUntil:30,isTester:31}}),qr("createUser",async function(t){var r;return ke("createUser"),(r=Le()).email=t.email,r.subscribedUntil=t.subscribedUntil,r.isTester=t.isTester,r.passwordSHSH=await _r(t.passwordSH),Fe(r)},{bodySizeLimit:1220,authOption:m,argsSchema:{email:6,passwordSH:9,subscribedUntil:30,isTesterAccount:31},resultSchema:8,responseAuth:S}),qr("deleteUser",function(t){ke("deleteUser"),De(t)},{bodySizeLimit:500,authOption:m,argsSchema:7});const Ke=require("node:http");var Me,Ge,Ze,Ye,Qe,We,Xe,tn,rn,en,nn,on,an,fn,un,sn,ln,cn,dn,hn,yn,gn=t.n(Ke);require("node:fs"),require("node:crypto"),({log:Xe,olog:rn}=w("scimodule")),Ye={error:19},Qe=0,hn=null,dn=Object.create(null),nn=function(t){t.statusCode=400,t.setHeader("Content-Type","text/plain"),t.end('400 "Request Malformed!"\n'),null!=arguments[1]&&console.error(arguments[1])},on=function(t){t.statusCode=401,t.setHeader("Content-Type","text/plain"),t.end('401 "Not Authorized!"\n'),null!=arguments[1]&&console.error(arguments[1])},an=function(t){t.statusCode=404,t.setHeader("Content-Type","text/plain"),t.end('404 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},fn=function(t){t.statusCode=405,t.setHeader("Content-Type","text/plain"),t.end('405 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},un=function(t){t.statusCode=413,t.setHeader("Content-Type","text/plain"),t.end('413 "Payload too large!"\n'),null!=arguments[1]&&console.error(arguments[1])},sn=function(t){t.statusCode=500,t.setHeader("Content-Type","text/plain"),t.end('500 "Execution Error!"\n'),null!=arguments[1]&&console.error(arguments[1])},ln=function(t,r){t.statusCode=422,t.setHeader("Content-Type","text/plain"),t.end(`422 ${r}\n`),null!=arguments[1]&&console.error(r)},cn=function(t,r){t.setHeader("Content-Type","application/json"),"string"==typeof r&&r.length>0?(t.statusCode=200,t.end(r)):(t.statusCode=204,t.end())},tn=function(t,r){var e,n,i,o,a,f,u,s,l,c,d,h,y;return Xe("mainRequestHandler_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-\n"),Xe(`req.url: ${t.url}`),Xe(`req.method: ${t.method}`),Xe(`req.headers[Content-Type]: ${t.headers["content-type"]}`),Xe(`req.headers[Content-Length]: ${t.headers["content-length"]}`),Xe(`req.headers[Transfer-Encoding]: ${t.headers["transfer-encoding"]}`),rn(t.headers),r.on("error",function(t){return console.error(t)}),t.on("error",function(t){return console.error(t)}),"GET"!==t.method&&"POST"!==t.method?fn(r):(y=t.url,h=t.method[0],null==(c=dn[`${h}${y}`])?an(r):(i=c.bodySizeLimit||Qe,o=parseInt(t.headers["content-length"])||0,a=t.headers["content-type"],rn({cLength:o,cType:a,isJson:d="application/json"===a,hasBody:l=o>0}),d&&!l||l&&0===i?nn(r):(f={meta:Object.create(null),bodyString:"",bodyObj:void 0,auth:void 0,args:void 0},Object.freeze(f.meta),l?o>i?un(r):(e=[],n=0,u=function(a){return Xe("dataRead"),(n+=a.length)>i||n>o?(rn({bodyLength:n,bodySizeLimit:i,cLength:o}),un(r),t.destroy()):e.push(a)},t.on("data",u),s=function(){if(Xe("dataStreamEnd"),n!==o)return rn({bodyLength:n,cLength:o}),un(r),t.destroy();if(f.bodyString=Buffer.concat(e,n).toString("utf8"),d)try{f.bodyObj=JSON.parse(f.bodyString)}catch(t){return nn(r)}en(t,r,c,f)},void t.on("end",s)):d?nn(r):en(t,r,c,f))))},en=async function(t,r,e,n){var i,o;Xe("processRequest"),void 0===n.bodyObj?(n.auth=n.bodyString,n.args=n.bodyString):null===n.bodyObj?(n.auth=null,n.args=null):(o=n.bodyObj.auth,i=n.bodyObj.args,void 0===o&&void 0===i?(n.auth=n.bodyObj,n.args=n.bodyObj):(n.auth=o,n.args=i));try{await e.handler(t,r,n)}catch(t){sn(r,t)}},Me=function(t,r){Xe("clientErrorHandler"),"ECONNRESET"!==t.code&&r.writable&&r.end("HTTP/1.1 400 Bad Request\r\n\r\n")},yn=function(t){var r,e,n,i,o;Xe("setupHTTPServer"),null!=t&&"object"==typeof t||(t={}),Xe("0"),Qe=t.bodySizeLimit||5e5,Xe("1"),o=t.requestTimeout||5e4,r=t.headersTimeout||8e3,n=t.keepAliveTimeout||12e4,t.maxHeadersCount,i=t.maxHeaderSize||2048,Xe("2"),e={headersTimeout:r,maxHeaderSize:i,requestTimeout:o,keepAliveTimeout:n},Xe("3"),(hn=gn().createServer(e)).on("request",tn),hn.on("clientError",Me),Xe("4"),hn.listen(3333),Xe("Server listening!")};var pn,vn,wn=function(){var t,r,e,n,i;for(Xe("prepareAndExpose"),n=Lr(),rn(n),i=Ze(n),Vr(),t=0,r=i.length;t<r;t++)e=i[t],dn[e[0]]=e[1];rn(dn),yn({})};Ze=function(t){var r,e,n,i,o;if(null!=t&&"object"==typeof t){for(o=[],r=0,i=(n=Object.keys(t)).length;r<i;r++)e=n[r],o.push(...Ge(e,t[e]));return o}},Ge=function(t,r){var e,n,i,o,a,f,u,s,l,c,d;if(Xe(`compile ${t}`),rn(r),"/"===t[0]&&(t=t.slice(1)),o=r.func,i=r.conf,"function"!=typeof o)throw new Error(`No func for '${t}'!`);if("object"!=typeof i||null==i)throw new Error(`No conf for '${t}'!`);return s=`P/${t}`,a=null,null==i.authOption&&null==i.argsSchema&&(null==i.bodySizeLimit&&(i.bodySizeLimit=0),t.length>3&&0===t.indexOf("get")&&(a="G/",a+=t.slice(3,4).toLowerCase(),a+=t.slice(4))),e=null!=i.authOption?"1":"0",n=null!=i.argsSchema?"1":"0",c=null!=i.resultSchema?"1":"0",l=null!=i.responseAuth?"1":"0",Xe("handlerType: "+(f=`${e}${n}${c}${l}`)),u=We[f](t,o,i),rn({postRoute:s,getRoute:a}),d={handler:u,bodySizeLimit:i.bodySizeLimit},Object.freeze(d),null!=a?[[a,d],[s,d]]:[[s,d]]},(We=Object.create(null))["0000"]=function(t,r,e){return async function(e,n,i){var o,a;return""!==i.bodyString||void 0!==i.bodyObj||void 0!==i.auth||void 0!==i.args?nn(n,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(i),(a=await r(void 0,i))?"string"==typeof a&&a.length>0?(o=JSON.stringify(a),ln(n,o)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(o=JSON.stringify(a[0]),ln(n,o)):checkForValidErrorObject(a)?sn(n,"Invalid result!"):(o='{"error":'+JSON.stringify(a.error)+"}",ln(n,o)):cn(n,""))}},We[1e3]=function(t,r,e){var n,i;if("function"!=typeof(n=e.authOption))throw new Error(`authOption not a function @${t}!`);return i=async function(t,e,i){var o,a,f;return(o=await n(t,i))?on(e,`Authentication fail! (${o})`):(Object.freeze(i.auth),i.args=void 0,Object.freeze(i),(f=await r(void 0,i))?"string"==typeof f&&f.length>0?(a=JSON.stringify(f),ln(e,a)):Array.isArray(f)&&1===f.length&&"string"==typeof f[0]&&f[0].length>0?(a=JSON.stringify(f[0]),ln(e,a)):(o=checkForValidErrorObject(f))?sn(e,"Invalid result!"):(a='{"error":'+JSON.stringify(f.error)+"}",ln(e,a)):cn(e,""))},i},We["0100"]=function(t,r,e){var n,i;if("function"!=typeof(i=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);return n=async function(t,e,n){var o,a,f;return(o=i(n.args))?nn(e,`Validation fail! (${o})`):(Object.freeze(n),(f=await r(n.args,n))?"string"==typeof f&&f.length>0?(a=JSON.stringify(f),ln(e,a)):Array.isArray(f)&&1===f.length&&"string"==typeof f[0]&&f[0].length>0?(a=JSON.stringify(f[0]),ln(e,a)):(o=checkForValidErrorObject(f))?sn(e,"Invalid result!"):(a='{"error":'+JSON.stringify(f.error)+"}",ln(e,a)):cn(e,""))},n},We[1100]=function(t,r,e){var n,i,o;if("function"!=typeof(n=e.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(o=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);return i=async function(t,e,i){var a,f,u;return(a=await n(t,i))?on(e,`Authentication fail! (${a})`):(Object.freeze(i.auth),(a=o(i.args))?nn(e,`Validation fail! (${a})`):(Object.freeze(i),(u=await r(i.args,i))?"string"==typeof u&&u.length>0?(f=JSON.stringify(u),ln(e,f)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(f=JSON.stringify(u[0]),ln(e,f)):(a=checkForValidErrorObject(u))?sn(e,"Invalid result!"):(f='{"error":'+JSON.stringify(u.error)+"}",ln(e,f)):cn(e,"")))},i},We["0010"]=function(t,r,e){var n;if("function"!=typeof(n=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);return async function(e,i,o){var a,f;return""!==o.bodyString||void 0!==o.bodyObj||void 0!==o.auth||void 0!==o.args?nn(i,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(o),f=await r(void 0,o),n(f)?"string"==typeof f&&f.length>0?(a=JSON.stringify(f),ln(i,a)):Array.isArray(f)&&1===f.length&&"string"==typeof f[0]&&f[0].length>0?(a=JSON.stringify(f[0]),ln(i,a)):checkForValidErrorObject(f)?sn(i,"Invalid result!"):(a='{"error":'+JSON.stringify(f.error)+"}",ln(i,a)):cn(i,JSON.stringify(f)))}},We[1010]=function(t,r,e){var n,i,o,a;if("function"!=typeof(n=e.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(a=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(i=Cr(Ye)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);return o=async function(t,e,o){var f,u,s;return(f=await n(t,o))?on(e,`Authentication fail! (${f})`):(Object.freeze(o.auth),o.args=void 0,Object.freeze(o),s=await r(void 0,o),(f=a(s))?"string"==typeof s&&s.length>0?(u=JSON.stringify(s),ln(e,u)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(u=JSON.stringify(s[0]),ln(e,u)):(f=i(s))?sn(e,"Invalid result!"):(u='{"error":'+JSON.stringify(s.error)+"}",ln(e,u)):cn(e,JSON.stringify(s)))},o},We["0110"]=function(t,r,e){var n,i,o,a;if("function"!=typeof(o=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(a=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(n=Cr(Ye)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);return i=async function(t,e,i){var f,u,s;return(f=o(i.args))?nn(e,`Validation fail! (${f})`):(Object.freeze(i),s=await r(i.args,i),(f=a(s))?"string"==typeof s&&s.length>0?(u=JSON.stringify(s),ln(e,u)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(u=JSON.stringify(s[0]),ln(e,u)):(f=n(s))?sn(e,"Invalid result!"):(u='{"error":'+JSON.stringify(s.error)+"}",ln(e,u)):cn(e,JSON.stringify(s)))},i},We[1110]=function(t,r,e){var n,i,o,a,f;if("function"!=typeof(n=e.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(a=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(f=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(i=Cr(Ye)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);return o=async function(t,e,o){var u,s,l;return(u=await n(t,o))?on(e,`Authentication fail! (${u})`):(Object.freeze(o.auth),(u=a(o.args))?nn(e,`Validation fail! (${u})`):(Object.freeze(o),l=await r(o.args,o),(u=f(l))?"string"==typeof l&&l.length>0?(s=JSON.stringify(l),ln(e,s)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(s=JSON.stringify(l[0]),ln(e,s)):(u=i(l))?sn(e,"Invalid result!"):(s='{"error":'+JSON.stringify(l.error)+"}",ln(e,s)):cn(e,JSON.stringify(l))))},o},We["0001"]=function(t,r,e){var n;if("function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return async function(e,i,o){var a,f,u;return""!==o.bodyString||void 0!==o.bodyObj||void 0!==o.auth||void 0!==o.args?nn(i,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(o),(f=await r(void 0,o))?"string"==typeof f&&f.length>0?(a='{"error":'+JSON.stringify(f)+"}",a=await n(a,o),ln(i,a)):Array.isArray(f)&&1===f.length&&"string"==typeof f[0]&&f[0].length>0?(a='{"error":'+JSON.stringify(f[0])+"}",a=await n(a,o),ln(i,a)):checkForValidErrorObject(f)?sn(i,"Invalid result!"):(a='{"error":'+JSON.stringify(f.error)+"}",a=await n(a,o),ln(i,a)):(u=await n('{"result":""}',o),cn(i,u)))}},We[1001]=function(t,r,e){var n,i,o;if("function"!=typeof(i=e.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(t,e,o){var a,f,u,s;return(a=await i(t,o))?on(e,`Authentication fail! (${a})`):(Object.freeze(o.auth),o.args=void 0,Object.freeze(o),(u=await r(void 0,o))?"string"==typeof u&&u.length>0?(f='{"error":'+JSON.stringify(u)+"}",f=await n(f,o),ln(e,f)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(f='{"error":'+JSON.stringify(u[0])+"}",f=await n(f,o),ln(e,f)):(a=checkForValidErrorObject(u))?sn(e,"Invalid result!"):(f='{"error":'+JSON.stringify(u.error)+"}",f=await n(f,o),ln(e,f)):(s=await n('{"result":""}',o),cn(e,s)))},o},We["0101"]=function(t,r,e){var n,i,o;if("function"!=typeof(o=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return i=async function(t,e,i){var a,f,u,s;return(a=o(i.args))?nn(e,`Validation fail! (${a})`):(Object.freeze(i),(u=await r(i.args,i))?"string"==typeof u&&u.length>0?(f='{"error":'+JSON.stringify(u)+"}",f=await n(f,i),ln(e,f)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(f='{"error":'+JSON.stringify(u[0])+"}",f=await n(f,i),ln(e,f)):(a=checkForValidErrorObject(u))?sn(e,"Invalid result!"):(f='{"error":'+JSON.stringify(u.error)+"}",f=await n(f,i),ln(e,f)):(s=await n('{"result":""}',i),cn(e,s)))},i},We[1101]=function(t,r,e){var n,i,o,a;if("function"!=typeof(i=e.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(a=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(t,e,o){var f,u,s,l;return(f=await i(t,o))?on(e,`Authentication fail! (${f})`):(Object.freeze(o.auth),(f=a(o.args))?nn(e,`Validation fail! (${f})`):(Object.freeze(o),(s=await r(o.args,o))?"string"==typeof s&&s.length>0?(u='{"error":'+JSON.stringify(s)+"}",u=await n(u,o),ln(e,u)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(u='{"error":'+JSON.stringify(s[0])+"}",u=await n(u,o),ln(e,u)):(f=checkForValidErrorObject(s))?sn(e,"Invalid result!"):(u='{"error":'+JSON.stringify(s.error)+"}",u=await n(u,o),ln(e,u)):(l=await n('{"result":""}',o),cn(e,l))))},o},We["0011"]=function(t,r,e){var n,i,o;if("function"!=typeof(o=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(i=Cr(Ye)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if("function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return async function(e,a,f){var u,s,l;return""!==f.bodyString||void 0!==f.bodyObj||void 0!==f.auth||void 0!==f.args?nn(a,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(f),s=await r(void 0,f),o(s)?"string"==typeof s&&s.length>0?(u='{"error":'+JSON.stringify(s)+"}",u=await n(u,f),ln(a,u)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(u='{"error":'+JSON.stringify(s[0])+"}",u=await n(u,f),ln(a,u)):i(s)?sn(a,"Invalid result!"):(u='{"error":'+JSON.stringify(s.error)+"}",u=await n(u,f),ln(a,u)):(l='{"result":'+JSON.stringify(s)+"}",l=await n(l,f),cn(a,l)))}},We[1011]=function(t,r,e){var n,i,o,a,f;if("function"!=typeof(i=e.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(f=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(o=Cr(Ye)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if("function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return a=async function(t,e,a){var u,s,l,c;return(u=await i(t,a))?on(e,`Authentication fail! (${u})`):(Object.freeze(a.auth),a.args=void 0,Object.freeze(a),l=await r(void 0,a),(u=f(l))?"string"==typeof l&&l.length>0?(s='{"error":'+JSON.stringify(l)+"}",s=await n(s,a),ln(e,s)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(s='{"error":'+JSON.stringify(l[0])+"}",s=await n(s,a),ln(e,s)):(u=o(l))?sn(e,"Invalid result!"):(s='{"error":'+JSON.stringify(l.error)+"}",s=await n(s,a),ln(e,s)):(c='{"result":'+JSON.stringify(l)+"}",c=await n(c,a),cn(e,c)))},a},We["0111"]=function(t,r,e){var n,i,o,a,f;if("function"!=typeof(a=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(f=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(i=Cr(Ye)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if("function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(t,e,o){var u,s,l,c;return(u=a(o.args))?nn(e,`Validation fail! (${u})`):(Object.freeze(o),l=await r(o.args,o),(u=f(l))?"string"==typeof l&&l.length>0?(s='{"error":'+JSON.stringify(l)+"}",s=await n(s,o),ln(e,s)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(s='{"error":'+JSON.stringify(l[0])+"}",s=await n(s,o),ln(e,s)):(u=i(l))?sn(e,"Invalid result!"):(s='{"error":'+JSON.stringify(l.error)+"}",s=await n(s,o),ln(e,s)):(c='{"result":'+JSON.stringify(l)+"}",c=await n(c,o),cn(e,c)))},o},We[1111]=function(t,r,e){var n,i,o,a,f,u;if(Xe("handlerCreator 1111:"),"function"!=typeof(i=e.authOption))throw new Error(`authOption not a function @${t}!`);if(Xe("0"),"function"!=typeof(f=Cr(e.argsSchema)))throw new Error(`validateArgs is not a function @${t}!`);if(Xe("1"),"function"!=typeof(u=Cr(e.resultSchema)))throw new Error(`validateResult is not a function @${t}!`);if(Xe("2"),"function"!=typeof(o=Cr(Ye)))throw new Error(`checkForValidErrorObject is not a function @${t}!`);if(Xe("3"),"function"!=typeof(n=e.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return Xe("creating the handler..."),a=async function(t,e,a){var s,l,c,d;return(s=await i(t,a))?on(e,`Authentication fail! (${s})`):(Object.freeze(a.auth),(s=f(a.args))?nn(e,`Validation fail! (${s})`):(Object.freeze(a),c=await r(a.args,a),(s=u(c))?"string"==typeof c&&c.length>0?(l='{"error":'+JSON.stringify(c)+"}",l=await n(l,a),ln(e,l)):Array.isArray(c)&&1===c.length&&"string"==typeof c[0]&&c[0].length>0?(l='{"error":'+JSON.stringify(c[0])+"}",l=await n(l,a),ln(e,l)):(s=o(c))?sn(e,"Invalid result!"):(l='{"error":'+JSON.stringify(c.error)+"}",l=await n(l,a),ln(e,l)):(d='{"result":'+JSON.stringify(c)+"}",d=await n(d,a),cn(e,d))))},a},({log:pn,olog:vn}=w("startupmodule")),de(Dt);var bn,mn,Sn=function(){pn("serviceStartup"),wn()};({log:bn,olog:mn}=w("subscriptionmodule"));var On=function(){bn("initialize")};const An={adminauthmodule:r,authutilmodule:e,configmodule:n,debugmodule:i,errormodule:o,rpcapimodule:l,scimodule:c,sciregistrymodule:f,servicekeysmodule:u,startupmodule:d,subscriptionmodule:g,userauthmodule:a,userdatamodule:s};global.allModules=An,async function(){var t,r,e;e=function(){var e;for(r in e=[],An)null!=(t=An[r]).initialize&&e.push(t.initialize(n));return e}(),await Promise.all(e),An.startupmodule.serviceStartup()}()})();